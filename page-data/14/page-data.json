{"componentChunkName":"component---src-templates-post-jsx","path":"/14/","result":{"data":{"site":{"siteMetadata":{"title":"황창구리의 개발 블로그"}},"markdownRemark":{"id":"ebc3435a-d009-5d48-93fe-c38e33567868","excerpt":"저번 글까지는 클라이언트가 게임을 선택하고 그 게임에 맞는 Input 값을 입력하면 캐릭터가 조회되며 캐릭터에 대한 상세 정보를 보여주는 기능을 만들었었습니다. 이번에는 사용자들에게 조금 더 재미 요소를 추가하고자 하루동안 검색된 캐릭터들의 횟수를 구하여 메인페이지 조회시 랭킹을 보여주려고 합니다. 랭킹 기능 아키텍처 현재까지 구현된 캐릭터 조회 기능만 …","html":"<p>저번 글까지는 클라이언트가 게임을 선택하고 그 게임에 맞는 Input 값을 입력하면 캐릭터가 조회되며 캐릭터에 대한 상세 정보를 보여주는 기능을 만들었었습니다. 이번에는 사용자들에게 조금 더 재미 요소를 추가하고자 하루동안 검색된 캐릭터들의 횟수를 구하여 메인페이지 조회시 랭킹을 보여주려고 합니다.</p>\n<h3>랭킹 기능 아키텍처</h3>\n<p>현재까지 구현된 캐릭터 조회 기능만 생각해보면, 데이터베이스 없이 게임사 서버로 부터 받은 데이터를 정리하여 클라이언트에게 보내주기만 하면 됩니다. 하지만 새로 추가될 캐릭터들의 조회 횟수 랭킹을 구현하려면 사용자들이 조회한 캐릭터에 대한 정보를 데이터베이스에 기록해두어야합니다.</p>\n<h4>변경 전 아키텍처</h4>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; '>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/a3f182a8bc0f3b91b0e32057376efc8b/08d47/image.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 55.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACVUlEQVR42oVS7U9SURzmn6qltdIkiJzhG2kvImISBjoBnbYSe3WpgbQAUXINe9l0a6svuT71pQ+tLa0PWSDomm/cTAcXuCD3Xp7OOehyrZezPfd3zu/c85znPL+fQt3QAUvfEHStvaioa8cJnQXKeguLqjPWP0JZf/mvUGgaO2HtG4bJcQcnCflRrQlKQnyk6iIOaQwoOdWCw5VGlJJI56VkXlH3D0L6Ka8xM3VlJLZY+/HapsQznxsPQi8ReDSD0YfT8E7OIDj1HLdcQaL+P4T0eZRQc7YTX8JRrL9/BWErDjYKBXjn01hJyXTBUjdGxpla+qL91vwi3FVZY+jGBrfJDomShFxeRF6SMTv3Aps8B1GU2d798ac4oNKjvNbMLKI2UBwna0aoIrfQRa2hB/HvP3aFFSARZHM5vP08i42tVZajwz32BAfVzdC3X8G5Ngd6rnvQTVB1wQZF5fkuXHIMwth1E/arLsxFFuD8EMTC+jek0jkkMzxi0RXwyRRRm2eEo0ShVm9HOLyITx/niXKJ5QeGxqA43WRnFaYe6oy9iCwv4030HbjtbaSFHSRSCcRiS1hdWwOf4iEXZPgmp9FKBPB8GhzHYTEaY4S3XRNQUP80jR0oqzahutmBOEeeLBUgyzLzL5PLQhDSyAgCsjtZdnDEGyL/tyFBVItiHslkslis4UDRQ9pXVKG6wYqvkSW2SQl/H3seOu/6WREcTjdpowlW9QGS0zbZioR7rXOMqNRb+uEJPIbbX4TLP8VwzxeCh3h3bdBLLjezM7T5S/Y1PK3yT/ehWipmiwF1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='서비스 아키텍처' title='' src='/dev-blog/static/a3f182a8bc0f3b91b0e32057376efc8b/08d47/image.png' srcset='/dev-blog/static/a3f182a8bc0f3b91b0e32057376efc8b/e7570/image.png 170w,\n/dev-blog/static/a3f182a8bc0f3b91b0e32057376efc8b/f46e7/image.png 340w,\n/dev-blog/static/a3f182a8bc0f3b91b0e32057376efc8b/08d47/image.png 624w' sizes='(max-width: 624px) 100vw, 624px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>서비스 아키텍처</figcaption>\n  </figure></p>\n<h4>변경 후 아키텍처</h4>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/746431b0eb7a4c3230997c9ee8855be8/a54a1/image-1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 75.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC7ElEQVR42o2U+0uTURjH909lUC5kN6/Tbc6W81JNne4+yEtpahZRePmhCKIgKIQUSV0JKpT+0E8FEeKl5h1Nm9O5TZuie9/t23PO9pZBRoc9vOec9zyfPef7PM8ryzd7UG5vRV6pB4piGzQXHcgusSP7ohPZphOWXmvoqaL3KuPfTVZS1YTG2w9hvXYXmhIHlEYn5CVeyHV1uFBk5ZZZWAN5ep6lq+Vg9SlQmTTJMbmgIJjBbMPzGgVuNLXB0dwNT3MnGtu64G3phKelGxZPBxSGulSk/wKyQ4WV9fgyM4vd0QcQ93fARjKZxIu5Q2z+ECGNjq4nkFPUTB7mq6abMeNAFjp7kaW3otx2E3FBRPjwGHExAfpBEJPwTX3G1l4EiUSSA/sGR3Euz0JXd6WDsXHjQJYIFp1cW43S2mYekTSERAJJgr6b7cVmeJnCTe2/fEXAfAvURhuUhhoUlHm5qYgl012uR4WjFYarDXBf78K3aAADyxM4OI7jKC7iWDhCKBRFJLJHEYvpCMdwNucK3oxNYtj3GvNLqwhH9/DoWT9kZbZW2BvvI8/shr3+HuaDK+j+2ItAKITofoypiFjsAOvrG9gNhzlwcOQttOVebHwPIhLeRSAQ4Pu+0UnImA65pW5kFlTDXNcCIS7gkADs6nFB4FHFYjEEg1vY3tnmjv1DY3S+CpuB1DoajfwGKotTYrL6MpOGAkGkIckpiiI3KSm9AyM4o65A//A4pmb8+PBpGtNzC7jT8zRVNuoTqe8bGsfq2gbmF1e4NovLq/jqX8CcfwkLy2scYHG380Sep8RkaCqQkV3Jnyyxv+pQArKraCh7bK7TV0OptVJ5NKCA5mytKqziHSO1IZMs1Z4uXn5/AFm/cjCrLZLCaLKh47EPPb5pjE+8Ry7t5ZCpyVEq6lM7hZnUTqzYGdBATn7/IqtIrJAM+kv0p/paAjr/DyhFycDMSUs6ub230NrWA5enHUUGK3LpjMbkPPVr8xP7HQ8SDYOdrwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='서비스 아키텍처' title='' src='/dev-blog/static/746431b0eb7a4c3230997c9ee8855be8/ca1dc/image-1.png' srcset='/dev-blog/static/746431b0eb7a4c3230997c9ee8855be8/e7570/image-1.png 170w,\n/dev-blog/static/746431b0eb7a4c3230997c9ee8855be8/f46e7/image-1.png 340w,\n/dev-blog/static/746431b0eb7a4c3230997c9ee8855be8/ca1dc/image-1.png 680w,\n/dev-blog/static/746431b0eb7a4c3230997c9ee8855be8/a54a1/image-1.png 901w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>서비스 아키텍처</figcaption>\n  </figure></p>\n<p>그러기 위해 RDS를 추가하고, 캐릭터에 대한 조회 정보를 데이터베이스에 기록하기로 결정했습니다. </p>\n<h3>dev 환경 MySQL 구축하기</h3>\n<p>현재는 운영 환경 서버가 구축된 것이 아니기 때문에 개인 NAS 서버에 있는 Docker를 활용하여 MySQL 서버를 구축했습니다. </p>\n<h4>레지스트리에서 MySQL 선택</h4>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/ee703a72a10af1acdf2fac990191dd5c/0b8c0/image-2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 25.294117647058822%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvElEQVR42n2P4Q6DIAyEff9nXGKWqZtTJzARpIVbZWq2HxvJF5rC3bVF2SpoY6C1gV8WJACcVlKuIfdPPt45EJgIxTRNcN5jPyR137To6ivcqDZN+g8zrPy3VSOGdoaS6dKWGL1De67EtMbc92COAoMk/Q1n9l7WrdL0Di7sZGVdfYweY0R9H3B7jNAy/RKCQAd+CZm9JgmM68obRVc2qE4XjM0ALbjnnA2vnRJTBWMdjAsHc4jfUISjdPACkd6GP69jzZYAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='alt text' title='' src='/dev-blog/static/ee703a72a10af1acdf2fac990191dd5c/ca1dc/image-2.png' srcset='/dev-blog/static/ee703a72a10af1acdf2fac990191dd5c/e7570/image-2.png 170w,\n/dev-blog/static/ee703a72a10af1acdf2fac990191dd5c/f46e7/image-2.png 340w,\n/dev-blog/static/ee703a72a10af1acdf2fac990191dd5c/ca1dc/image-2.png 680w,\n/dev-blog/static/ee703a72a10af1acdf2fac990191dd5c/02d09/image-2.png 1020w,\n/dev-blog/static/ee703a72a10af1acdf2fac990191dd5c/0b8c0/image-2.png 1043w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>alt text</figcaption>\n  </figure>\nNAS의 Container Manager에 들어가서 레지스트리 탭을 선택 후 MySQL을 선택하여 클릭합니다.</p>\n<h4>이미지 실행</h4>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/e6f2a1eb0b8338989acc65a66b990eb9/a27c6/image-3.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrElEQVR42p1S227dIBD0/39cVSkPfWmj5Fx8A8zdYGw8HY6SHLXqU1dagRaYZWa2+/Ym8TooGGMgFw0hFY7jwP9Gl7aCsCbUWlHP87GeXFu46x36/YZFGwhjYcMK7QOU8RjlAqEtVw0b18c+pIzOeY9bPyDl7dnmE7CfoC93Aloo67HmAh8TtA0QioxY18YhEcixUeJ5t+87XAiwLPwd7cepVJRSkHNmbl9yNBYba6kc8PlEKMC2V3Q5RshhgpGSle2ZbNQAl0TQlCCVgrWOR08m1loIu2IKFSIcCPlAt1xn/Pw14HoRUCpCiIB5Dojzgp0/WmaLqDSWYcbuIooL2Eh/I1XH/bodKMf5lZ2fJKbbCNULOGmxUvCwOD6mDNLh7WrRjxbvbCjUilnExyp6jctlwo8x4Xu/42XY8SqpYdNHkq4UEvWhz/mRwEHaxdEMuizvPX/ZGo/YqfdJZx3PCu98+tgk6jYCao5EXNc/DDk/hG+7ZlwzzXAiDEHaaLWIMUDajMFVTL7CJ2rYXPO8/K9hrvWETZUPIwwNaMCNUWvUMoSm4Y5Yzkc2l38DhLcG4mJa71QAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='alt text' title='' src='/dev-blog/static/e6f2a1eb0b8338989acc65a66b990eb9/ca1dc/image-3.png' srcset='/dev-blog/static/e6f2a1eb0b8338989acc65a66b990eb9/e7570/image-3.png 170w,\n/dev-blog/static/e6f2a1eb0b8338989acc65a66b990eb9/f46e7/image-3.png 340w,\n/dev-blog/static/e6f2a1eb0b8338989acc65a66b990eb9/ca1dc/image-3.png 680w,\n/dev-blog/static/e6f2a1eb0b8338989acc65a66b990eb9/a27c6/image-3.png 700w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>alt text</figcaption>\n  </figure> <br>\n이미지 탭에 들어가서 MySQL을 실행시킵니다.</p>\n<h4>이미지 설정</h4>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/d9555fb1b44c6f886b8d0924fff51122/660ed/image-4.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 77.64705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB5ElEQVR42q2Sy27UMBSGIySEYMcaFiDxEqx5Ct4AseRSkGBRFixaFbZsWfIIU3gOFpBFaCnTmUzs2InjJLaTn2NPQoeZUVUqLH3Kxceff58kunvAcGuP4fY+w713DDffZri2u8D1NxfnBnF1l+HBhyNEd/azILryMkW0Q7wYmW8h3UpY+zTD/fcJoldfKrwmnk/UXzw7pHeHOuDvw/NazcjOpMSTicbe5ymiVit0zmJ92EpC8zlMJfzTwPbR9324phlDxHOJBctRVRqu6+Fooq1azL4lOPme4DROMI1/oPh5ilI7FE0fKFeQdYfKAIzniJzrUJQKC7LnQi537DpK1sDULSxhdBMIG1KYQHeGdcuEPOeIfFxjTKAjURASxjkqdKjajha5IGvbNhxvrFs/MueDUNc16oYSkGCYQ216VA3JKIKv8ShKXagapVJ/JBtCax0yxqmPDLMFg6oNLKV1aynOG6NQCLHsoZAF8lzQC0n3knbKIdTQM99Pa0NSjw+wmm5VKGltOLINC84K/YXLElleQpY6HLVuLHRj6Es31MNzhOsTY9OF0shIqugrX/TIG8LLDO8aE/8X4WYPh//uXxhbqKVCfCQQH0scT0vweXo5oRsSfY0ZHn6c4dGnFI+JX8kJfgPLIJwCiAN1PwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='alt text' title='' src='/dev-blog/static/d9555fb1b44c6f886b8d0924fff51122/ca1dc/image-4.png' srcset='/dev-blog/static/d9555fb1b44c6f886b8d0924fff51122/e7570/image-4.png 170w,\n/dev-blog/static/d9555fb1b44c6f886b8d0924fff51122/f46e7/image-4.png 340w,\n/dev-blog/static/d9555fb1b44c6f886b8d0924fff51122/ca1dc/image-4.png 680w,\n/dev-blog/static/d9555fb1b44c6f886b8d0924fff51122/660ed/image-4.png 741w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>alt text</figcaption>\n  </figure> <br>\nMySQL 버전과 컨테이너 이름을 설정해줍니다. <br></p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/8ae5ecf2e57ae55ee21420cbb6061ca2/64252/image-5.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA4ElEQVR42q1QW27EIAzM/W9XqQfoartJmkAIkAePwOyYSivtd2vJ8mCPxzZdqcAaKn62ilzwZ+vOENHPGoMyUGaFdR7GWrqDNgZmtdCLwcq3YKWXxmk88iUveCG+rgtd8B7T7QZ1/4afZmTnkCiY/IYzBOSckWJCSpn4QiSOMbbmlJiXOmuBixWe2xVOzI8BRS2oSjPqFgNzShs2FlR+i5AlBgp6v7/lhKPthkjhLk4K48cn9q876jCi9ANq3+N4jDzDtum1/DaLy4b7cb4ExUXQbieSnBx5Rj8vcPuB/7AnOvzTv5zLF+oAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='alt text' title='' src='/dev-blog/static/8ae5ecf2e57ae55ee21420cbb6061ca2/ca1dc/image-5.png' srcset='/dev-blog/static/8ae5ecf2e57ae55ee21420cbb6061ca2/e7570/image-5.png 170w,\n/dev-blog/static/8ae5ecf2e57ae55ee21420cbb6061ca2/f46e7/image-5.png 340w,\n/dev-blog/static/8ae5ecf2e57ae55ee21420cbb6061ca2/ca1dc/image-5.png 680w,\n/dev-blog/static/8ae5ecf2e57ae55ee21420cbb6061ca2/64252/image-5.png 696w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>alt text</figcaption>\n  </figure> <br>\n다음을 클릭하여 포트를 지정해줍니다. 이때 왼쪽은 컨테이너 밖의 외부 포트이고, 오른쪽은 컨테이너안에서 쓰이는 내부포트입니다. MySQL의 포트는 기본적으로 3306 이기 때문에 별도로 설정하지 않는 경우 오른쪽 내부 포트는 그대로 두면되고, 외부에서 접속하는 포트를 변경하고 싶을 땐 왼쪽은 다르게 포트를 주면 됩니다. <br></p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 335px; '>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/b0ad61f555972abc0d8c0e6220f246c2/56823/image-6.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 33.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABX0lEQVR42nWQ627aQBBG/f5vlKqJmpaqTS9Sq7bEGGwutjE4QMDeXa+9Xp8MVMoPqo706VtpZmfOTBDd3BGOvrD8+oPi55hft++ZP3zHLnNUvETPM/QkQT1O2RxrokVG+VxxqLTIUBmH7jzGDRcFu6JkLcn14URZa7L9MzvxDrDDQCPe9A6zyjiqhuLpwFHyJ3mfpa2j6aTO/VWQjkOSVUpRFJTlE3GyYBYnRFFMOJli2xb6Hic1prFo02CspW0dvfdcR1DlBZUW9FpRK/XqSgtFVWO7Dt92uCzDnRuLepGXZl42GK4UrP6ExIsVqzQjXxdCN6fYbNlst0yiGY9CedofGPL1hTAVgFYGdJ270Hp/1VDt9iiZaGQ1K17JOlXTiCxGPjlZoxf3eS50HqX0K+GZ9h/C+OYt4f2IZPSJ9OEb0/sP/H5zx/j2HfOPnxFs/CxhkLsaIVvILduu43/xAthxE+Tmmp0iAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='alt text' title='' src='/dev-blog/static/b0ad61f555972abc0d8c0e6220f246c2/56823/image-6.png' srcset='/dev-blog/static/b0ad61f555972abc0d8c0e6220f246c2/e7570/image-6.png 170w,\n/dev-blog/static/b0ad61f555972abc0d8c0e6220f246c2/56823/image-6.png 335w' sizes='(max-width: 335px) 100vw, 335px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>alt text</figcaption>\n  </figure> <br>\n마지막으로 컨테이너 안에서 실행될 환경변수를 설정해주어야합니다. 위 사진처럼 총 4개의 환경변수를 세팅하여, 실행시 해당하는 정보로 설정되어 실행될 수 있도록 합니다.</p>\n<h4>컨테이너 실행</h4>\n<p>마지막으로 컨테이너 실행을 시키면, 정상적으로 컨테이너가 올라오게되고 외부에서 접속하기 위해 공유기에서도 포트포워딩을 해주어야합니다. 저의 경우 이미 해당 NAS 서버가 DMZ 설정이 되어있어서 건너뛰도록 하겠습니다.</p>\n<h3>랭킹 기능 테이블 설계</h3>\n<p>우선 랭킹을 위해 저장해야하는 정보는 <code class=\"language-text\">게임명</code>,<code class=\"language-text\">월드명</code>,<code class=\"language-text\">캐릭터명</code>,<code class=\"language-text\">생성시각</code>,<code class=\"language-text\">수정시각</code> 총 5가지입니다. 카운트 컬럼을 따로 두어 해당 캐릭터가 몇번이나 조회되었는지 체크해서 랭킹을 산정할까도 고려했지만, 일일 단위로 조회 개수를 판단해야했기 때문에 해당 방식으로는 구현할 수 없었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> game_character_search_log <span class=\"token punctuation\">(</span>\n    id <span class=\"token keyword\">bigint</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span> <span class=\"token keyword\">auto_increment</span><span class=\"token punctuation\">,</span>\n    game_type <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n\tworld_name <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    character_name <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n\tcreated_at <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    updated_at <span class=\"token keyword\">datetime</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">engine</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span></code></pre></div>\n<p>위와 같이 테이블을 설계하고, 사용자들은 이제 캐릭터를 조회할 때 마다 위 정보가 자동으로 데이터베이스에 저장되어, 랭킹 산정을 위한 데이터를 쌓을 수 있게됩니다.</p>\n<h3>랭킹 기능 쿼리 작성</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">GameCharacterSearchLogRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">GameCharacterSearchLog</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token triple-quoted-string string\">\"\"\"\n            SELECT new com.chang.omg.domains.game.domain.GameCharacterSearchRank\n            (g.worldName, g.characterName, COUNT(g.characterName))\n            FROM GameCharacterSearchLog g \n            WHERE g.createdAt > CURRENT_DATE AND g.gameType =:gameType\n            GROUP BY g.characterName, g.worldName \n            ORDER BY COUNT(g.characterName) DESC\n            LIMIT 5\n            \"\"\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">GameCharacterSearchRank</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findGameCharacterSearchRank</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">GameType</span> gameType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 랭킹 기능에 대한 쿼리 작성 부분입니다. 복잡한 쿼리 작성을 위해 @Query 어노테이션을 이용했고, 별도의 DTO를 받기 위해 new를 이용하여 새로운 객체를 생성해서 담게되었습니다. </p>\n<p>쿼리는 특정 게임 유형에 해당하면서, 생성 날짜가 현재 날짜보다 늦은(즉, 오늘 생성된) 게임 캐릭터의 로그를 조회하여, 가장 많이 검색된 상위 5개의 캐릭터에 대한 정보를 불러오는 쿼리입니다.</p>\n<h3>쿼리 적용 후 실제 적용 화면</h3>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/0ceb52627fe2d42442b302f7c1cd6df1/4c573/image-7.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 124.11764705882354%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAABYlAAAWJQFJUiTwAAADiklEQVR42pVVWU8TURTuDzJRIxCtSzQqSnAFFDc0LsFdtBaXxDVRo/HNaHzwXY0/gEQkojyAQYgQTaqVtrTTdpaW7qUwnc7nOXeYoYKonOTL3Hvn3G/Oued+Z1xeTwhvXo2hcfM3rHWHsWFtCOvXLA7r3EG07JbQ2izB1ekZwItnz7Fh9UesrInAXRfAqtoq1MzAWRtzxu66INasDGLZkjE8ezKB1y8zcDXtGEHLrnf0BT/2NkfR2hJF2wFV4OA+RWB2LOMQPQ/tp3mrTP6SwJ4mCfv3Sti6aRyu7rcFsJVKFVQqQCKRRk/PR/T19ePTp2GBrq5uDAwMYmhoBMPDo+jvH8TXrz4YBjA9bWKK9rLduK7C9aHXIjQMUzynpqYgyzFomoqJiQl6ashk0kinU/QxDalUCslkQsA2e+/dWxpcve8twnLZhEnrpun4UcQVIklicrJEkUzTvOrljLE/72W7c1ObH6HlZArouo5YLCYgSRIRTzrvDMM6onkRziUsFAoCHB0TFotFMbdJ6HMYGSng8IEonj5JOtktSJjP5wWBQSdeKpWQzWbpDDNirusGHwQ+D+awrSGAh/eVvxPaZ1h9ltVnOrtmCnIr4n+kbM7skqQwAkE/fL5v+PHDJ56BgB9fvgyJilf7/pGQK8jv8zmDUIGq5Ig0RVcoCzmeQZTGoaCG0dGfCAUUhMN8jXILE7LJso7mnRHs2hbBlo0RUkOcVBCjMSmiKU6FiKOxPoLGrePY3hDEudPRhc+QLZksw3tJhqdDxtlTMVz1KvB6rLGnI45rnQounI3j0gVZ4PGjxL+rXKkYoqJWxbPIF+y0DFF928plXVwh6x0WqrJJjmUBNr6DxeKkQ8hz+2Kzz1+LYi+yI8vMirDgRMXruVyuSkWLIGSF2KrhqOx1e/yfEWJGXoaTMiuFu4+dMs9ntWwsPmVOkcHGjUFV1Sql6P9LaIjzmVsUJsxkso4A2I+7DY9/q/Lcfshf5jR5zNFxYewCccPlDLgTWf2x8ns/rCa0vmKKbmKaFnR9mjp2giSWoE6dFp3HNA0B9rMwm91tbrBt1NcuX5TRcU7GxfMMBZ0ehVSh4vYNDQ8faLh3VxOq4PEVr0rqUUg5CqlFEXt4L6tre0MErlW1QdQsC6B2uYWapWP0a/TTXzCAE0dDaD8+jmNHQjhzMozT7eP05wuifqMfK5b65sFd9x2/AIxe1MOWhj7QAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='alt text' title='' src='/dev-blog/static/0ceb52627fe2d42442b302f7c1cd6df1/ca1dc/image-7.png' srcset='/dev-blog/static/0ceb52627fe2d42442b302f7c1cd6df1/e7570/image-7.png 170w,\n/dev-blog/static/0ceb52627fe2d42442b302f7c1cd6df1/f46e7/image-7.png 340w,\n/dev-blog/static/0ceb52627fe2d42442b302f7c1cd6df1/ca1dc/image-7.png 680w,\n/dev-blog/static/0ceb52627fe2d42442b302f7c1cd6df1/02d09/image-7.png 1020w,\n/dev-blog/static/0ceb52627fe2d42442b302f7c1cd6df1/4c573/image-7.png 1300w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>alt text</figcaption>\n  </figure> <br>\n클라이언트에서 위와 같이 조회된 캐릭터에 대한 일일 랭킹을 볼 수 있게되었습니다.</p>\n<h3>개선해야할 점</h3>\n<p>지금까지 일일 랭킹을 만들기 위해 쿼리문을 이용하여 사용자들이 해당 페이지를 요청할 때마다 DB에서 데이터를 불러오도록 구현했습니다. 하지만 정말로 많은 사용자들이 해당 페이지를 요청할 때는 이러한 구조는 좋지 못합니다. 매번 데이터베이스로 쿼리가 나간다는 것은 성능상 좋지 못할 수 있는데요. 이러한 부분을 Redis의 Sorted Set을 활용하여 처리하거나, 비즈니스 로직을 변경하여 하루 단위로 일일 랭킹을 보여주거나 하는 방식으로 처리해볼 수 있을 것 같습니다. 나중에 이 부분에 대해서도 다뤄보도록 하겠습니다.</p>","frontmatter":{"title":"[OMG-7] 일일 캐릭터 조회 랭킹 구현하기","date":"March 15, 2024","update":"March 15, 2024","tags":["OMG","개발일지","서비스","게임","모바일","랭킹","백엔드"],"series":"취업도 못해본 개발자의 우당탕탕 실서비스 개발 및 운영 이야기"},"fields":{"slug":"/14/","readingTime":{"minutes":7.295}}},"seriesList":{"edges":[{"node":{"id":"fbb6dd9f-b5fe-5572-9f66-abb63917c06c","fields":{"slug":"/8/"},"frontmatter":{"title":"[OMG-1] 나 취업도 못했는데 실서비스 운영 한다!"}}},{"node":{"id":"d9a3fdf0-c2c6-5e38-8d4e-19b37a9fc375","fields":{"slug":"/9/"},"frontmatter":{"title":"[OMG-2] 기획자가 되어보자!"}}},{"node":{"id":"ce1621e5-748e-5a84-a7ed-7e83b0eff9b8","fields":{"slug":"/11/"},"frontmatter":{"title":"[OMG-3] API 요청 흐름에 대한 기능 설계 및 구현"}}},{"node":{"id":"efb7f7a6-8f21-5052-831b-e0f3a8428dcd","fields":{"slug":"/10/"},"frontmatter":{"title":"[OMG-4] 외부로 API 요청시 계속 Null이 나와요!"}}},{"node":{"id":"89b56ab8-b4aa-5a90-aae7-31db0a6ddc87","fields":{"slug":"/12/"},"frontmatter":{"title":"[OMG-5] dev 인프라 환경 ci/cd 구축하기"}}},{"node":{"id":"ebc3435a-d009-5d48-93fe-c38e33567868","fields":{"slug":"/14/"},"frontmatter":{"title":"[OMG-7] 일일 캐릭터 조회 랭킹 구현하기"}}},{"node":{"id":"8d0f272b-8f16-5116-b0ac-6013f542a633","fields":{"slug":"/13/"},"frontmatter":{"title":"[OMG-6] 나 백엔드인데 프론트(?)도 할 수 있다."}}},{"node":{"id":"ebe5e8aa-b589-564e-bf4d-05307ef1b652","fields":{"slug":"/16/"},"frontmatter":{"title":"[OMG-8] 일일 캐릭터 조회 랭킹 Redis Sorted Set으로 개선하기"}}}]},"previous":{"fields":{"slug":"/12/"},"frontmatter":{"title":"[OMG-5] dev 인프라 환경 ci/cd 구축하기"}},"next":{"fields":{"slug":"/13/"},"frontmatter":{"title":"[OMG-6] 나 백엔드인데 프론트(?)도 할 수 있다."}}},"pageContext":{"id":"ebc3435a-d009-5d48-93fe-c38e33567868","series":"취업도 못해본 개발자의 우당탕탕 실서비스 개발 및 운영 이야기","previousPostId":"89b56ab8-b4aa-5a90-aae7-31db0a6ddc87","nextPostId":"8d0f272b-8f16-5116-b0ac-6013f542a633"}},"staticQueryHashes":[],"slicesMap":{}}