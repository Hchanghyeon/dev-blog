{"componentChunkName":"component---src-templates-post-jsx","path":"/15/","result":{"data":{"site":{"siteMetadata":{"title":"황창구리의 개발 블로그"}},"markdownRemark":{"id":"95139dc9-c381-5d58-bd62-4451dbd3305f","excerpt":"중심 좌표로부터 특정 거리에 속하는 데이터 불러오기 1. 기능 저희 프로젝트에서는 위 사진처럼 사용자의 실시간 좌표 또는 특정 좌표를 받아서 해당 좌표를 기준으로 특정 거리에 속하는 게스트 모집(경기) 글을 불러와야합니다. 좌표를 이용하여 특정 거리에 속하는 게스트 모집글을 불러오는 방법은 아래와 같이 직각삼각형과 피타고라스의 정리를 이용하면 됩니다. 1…","html":"<h1>중심 좌표로부터 특정 거리에 속하는 데이터 불러오기</h1>\n<h2>1. 기능</h2>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/47945543f47db6d86a89a823b981e859/06066/1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 195.2941176470588%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAnCAIAAACABf9ZAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGlElEQVR42oVWWW/cyBHmf8xD3gJkX4M85jELJEAe8hAkTrJrL5Bk105sR7It2RvJkle2LI80mkMaSXOfPIb31SSbbHbzHKWGYxm7CBYpFDjFIb+u6q+qq8jd3t5GUSQIAlzBXq1Wtz8uRVHolXQ6ncViwW3A0+mUEPJ/wZTSXq/ned7p6elgMODSJEUIfQ/2o+A0TTVNS5LEtu2yLMHgYDHDMD6Bi3JVVvq/EWRZpigqctFsNkeeZ1kWp6jKalUSnMxH4XLieLLlB4ljRpQm4AqWZwkDASNjrCwKWCJNaZYGRZFzktQfTSaWj6yw1ASbCDOWpVFE4hg0BiJYnMAPTViQlpYbGarvuaFtGLYZctf91kmrMdt9cVurZbe3sbTwZyqJaZxklILXJIg9BiEEOHx5iGayIASjrjMfma6JOeyKSOlnn/+u/MnP8YKPPGTVxyEKqD7GvqV7+svxY5Ho8es3q59+Vjx/md6uFv3QMn0UShxxeHn4Rv38N9Fnv2geH4jTEZNlgv2k/cA3+b7cnyrDrtY3e53bn/0yOGt6lKqu0kC9xqLJMSS4atdZ9H1BkmTJ93xm62w2psIVpSRNM8hlmZVxmp19d/C+fX560Vq6Ms1YSkNuoKg7E/f85vpspilBHCd+pE7KP94r/vk0HexToY09ywvdeTCfR4qoKLwokZC4Loop5V5M5o/ayh9++6evvnqIsBnTIMXR7b372dauvdgbDLe7/HQy7QrLZYACUVb74yng5zMRcsFNrKvAMx88+Pv+7iFVSSB5oqBNjrYGB9+87TcXsuBioqhLWRZ006I0ztIM06Bp1CD5HEEamtT5qxPDmiiBfKXd8K6AEsebdhISF3nJTJ0SlGU+1Ax4YzFV7eV+b8f2TM7sH9bbB91ebaF0RX96Mxo3m1fjiZgaamDpZveGPfgHerXvoiUDXExDShauNJIHY2XA8ZOv+VDz4wDKWl0u3nw4/+vvv/j6/qMYB1iYXu69DL/8m7T93HaVLPGTLGeum1x1k5CwJOMy4bCkUZGWNKGiMbQM8emTredbO8i10OAmCpB58ipETsyYyPcVx04/1Mtf/ZoNByQLuVR6H9tDFOOUJXkSZtHSmrd6Z4fXrbo2uE5tM0opnA7fx7XzVu2i7Qz79PHTxBYJDbjEHAXCHo95C5OdObYcgWF9nVvk0ihkMp/lBZSKj21dn+raoC/x9euhH8VJknIEo0L8Do7dsRA8G9jnkuEpnUVrv9s6H15dTM9PbE32kYKxGsY4Cg3RtCXXN32sL0XO9qJCfk9dHvme58qWLQbWSOev1UVXkYbatKP02iFGIU0GNkPYzZnPQkQj3zENDkcsN6/S5ds4dExlbhtyHMoxFoi3SLMw8Jjal00tknhvOLZRQHzlYt56fX60N7q64BoXnX6n5lw+svT56Xn96LQxUkTfHmFjGmPbsZkwMIWBxs98Q4Z6Zhhi1GbibKIvp1y90Whe3uj9g5xouqGLJtIjOEpeIF0kgZGvVtg1I1OjaUpi4gYuIUFMfcbgaCIOusXJh1qj3Xn17V67fXlw+OasXv/2P/sntbMn/94SJTlmWRDGYUjCKAaNCL0zGOf5ePvZ89PT+tb2s/cntRc7uzu7L7e3n719e/zFl/eHo0mSFvgOeWd8xHMkZne9dlXctdxVJWDkeVFpvnkKkmX5WvOcQZ6hxUKPZQwKLKVVh3Uc5/LyEgbKaDSCsdDrdUVRBGba7Xar1YKztWnjeVGs95xm+d7+wb8eP7n3579AnNB3L0Da7fl8Dvhut7tcSs1mE5CwIsbh98A0gcDmC6F9eX1903NcFBECFmAEUZxOZ8ulPK8E5plUyccdbcAQNijyo5Cs41hHAvUMkyHL4Qq3cL/+Ly82MNd1YSMwRbiYJkVRsvVsyT4hYQ1azRjGKk3gNoFBswGvZxBjsCQHeQO2wDtoNZLAgNeKSitiMzhVa7cbo3oZxlUOXsEzK9ZSrucj5KMoIYagknAtETAEAqHCWMYYwyqbvK4908qtKClQTL3+0EU+jN+zMyizOnAG9DYaDfgIODo6evfu3fHx8Q9TVe15b//1Nw8fbkoKWiSkFJIF3xrj8RhI5vm1AWvNZjNZln/ANmwAZuhSMSwHyj2B4ahqmqJqjuMapgnDwTQtUNt2IHjYDlACnwRV2BT4yaFIMZQroRWredV6Nmzl61RV9QiuNj6hBCGodaoAVjG5Bnx8KS825G+Y/2TDU9hgRdiasTTN/gsi6UIHmWJxfgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='1' title='' src='/dev-blog/static/47945543f47db6d86a89a823b981e859/ca1dc/1.png' srcset='/dev-blog/static/47945543f47db6d86a89a823b981e859/e7570/1.png 170w,\n/dev-blog/static/47945543f47db6d86a89a823b981e859/f46e7/1.png 340w,\n/dev-blog/static/47945543f47db6d86a89a823b981e859/ca1dc/1.png 680w,\n/dev-blog/static/47945543f47db6d86a89a823b981e859/06066/1.png 729w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<p>저희 프로젝트에서는 위 사진처럼 사용자의 <strong>실시간 좌표</strong> 또는 <strong>특정 좌표</strong>를 받아서 해당 좌표를 기준으로 특정 거리에 속하는 게스트 모집(경기) 글을 불러와야합니다. 좌표를 이용하여 특정 거리에 속하는 게스트 모집글을 불러오는 방법은 아래와 같이 <strong>직각삼각형</strong>과 <strong>피타고라스의 정리</strong>를 이용하면 됩니다.</p>\n<h3>1.1 두 좌표 사이의 거리 구하기 - 피타고라스 공식</h3>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 424px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/07f64163c584f833aa88e39a572a09d7/4910e/2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 81.17647058823529%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/ElEQVR42qVTTW/aQBTk5zf/glsjDkgcipDgVHpKqSkJYOKPBDAEGwyYL4MxMN1ZsqsokKhqnzTSrnc9b968txn8Y5xOp6vfM2qx3+8RBAF2ux3+JzIq02g0QqVSwXQ6/VQBI01TDIdDHA6HjxXy0mw2w3a71YTvcTwe5dlyucLNzRdEUXSRXCtcLBbIZrMYj8ey/DiOJbkC9xuBND1bUzPqMoH6XyXVCim/Xq9jPp9/WvJsHsEw+3joPCPdJ9dLVj9LFZvNRcmMo0jY83w0bB+tXoRHdyCUx2i2WrIix3FklZm37KvVShMmSaJNZyLT8fDwFMIdCRISPr9gNg3x9fZWWlAsFmFZ1qXC9Xot19XqD7SaTeHbDr87HjqDFRw/hu1vYLohzKaN9JCKBi2lQjaVInRTaHypVJKd42EQ+Lj7+Qt3DQv39gvurQEajx4arii51sL3byV0vb5ujOLRhFRWKBTkHPISScMwFKM0FTashYpEDL3otrBkIVTVDAOmaf59U0iqZrLX6wvTbTn8ruvK+x/N6wUhoQjVut1uC0+rUn25XNa+XRstTZiIN8wSCWZnx+knFXNPS/jOued4EKoigud8FGfCVzAzLzJ4mM/nJQn9JKiKo0SiXC6n/WYYwlPiTMiPQuXbkhndbld79T48z5MCVEwmE/nK/gD3es94B9a0XgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2' title='' src='/dev-blog/static/07f64163c584f833aa88e39a572a09d7/4910e/2.png' srcset='/dev-blog/static/07f64163c584f833aa88e39a572a09d7/e7570/2.png 170w,\n/dev-blog/static/07f64163c584f833aa88e39a572a09d7/f46e7/2.png 340w,\n/dev-blog/static/07f64163c584f833aa88e39a572a09d7/4910e/2.png 424w' sizes='(max-width: 424px) 100vw, 424px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msqrt><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><msub><mi>y</mi><mn>2</mn></msub><mo>−</mo><msub><mi>y</mi><mn>1</mn></msub><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow></msqrt><mo>=</mo><mi>A</mi><mtext>와</mtext><mi>B</mi><mtext>사이의직선거리</mtext></mrow><annotation encoding=\"application/x-tex\">\\sqrt{(x_2-x_1)^2 + (y_2 - y_1)^2} = A와 B사이의 직선거리</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.24em;vertical-align:-0.25612499999999994em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.983875em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.740108em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.740108em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.9438750000000002em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.25612499999999994em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mord hangul_fallback\">와</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord hangul_fallback\">사</span><span class=\"mord hangul_fallback\">이</span><span class=\"mord hangul_fallback\">의</span><span class=\"mord hangul_fallback\">직</span><span class=\"mord hangul_fallback\">선</span><span class=\"mord hangul_fallback\">거</span><span class=\"mord hangul_fallback\">리</span></span></span></span></span>\n<p><strong>(x2-x1)의 제곱  +  (y2-y1)의 제곱 → 루트로 나눈 값 = A와 B의 직선거리</strong></p>\n<blockquote>\n<p><strong>하지만 이렇게 계산 할 경우 무슨 문제가 생기는걸까요?</strong></p>\n</blockquote>\n<p>위의 식은 평면 위에서는 전혀 문제가 되지 않습니다. 하지만 위도, 경도는 지구를 기준으로 정해진 것이기 때문에 지구가 둥글다는 것을 고려해야합니다. 위의 식에 위도, 경도를 대입해도 충분히 가까운 거리는 오차가 크지 않을 수 있지만 두 좌표 사이의 거리가 멀어지면 멀어질 수록 지구의 곡률을 영향받아 오차가 커지게 됩니다.</p>\n<h3>1.2 두 좌표 사이의 거리 구하기 - 하버사인 공식</h3>\n<p>하버사인 공식은 <strong>지구가 완전히 구형</strong>이라고 가정하고 <code class=\"language-text\">경도</code>와 <code class=\"language-text\">위도</code>를 고려하여 구 위의 두 점 사이의 대원 거리를 결정하는 공식입니다. 위에서 얘기한 <strong>피타고라스 공식을 이용한 두 좌표 사이의 거리 구하기를 극복할 수 있는 공식</strong>인거죠. 하지만 지구는 완전한 구형이 아니기 때문에 아주 작은 오차는 있을 수 있습니다.</p>\n<p><strong>하버사인 공식을 이용한 JPQL 쿼리 적용</strong></p>\n<p><strong>GameRepository</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">GameRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Game</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">String</span> <span class=\"token constant\">HAVERSINE_FORMULA</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"(6371 * acos(cos(radians(:latitude)) * cos(radians(g.latitude)) *\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\" cos(radians(g.longitude) - radians(:longitude)) + sin(radians(:latitude)) * sin(radians(g.latitude))))\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Game</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findByAddressDepth1AndAddressDepth2</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">AddressDepth1</span> addressDepth1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">AddressDepth2</span> addressDepth2<span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">Pageable</span> pageable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SELECT g FROM Game g WHERE \"</span> <span class=\"token operator\">+</span> <span class=\"token constant\">HAVERSINE_FORMULA</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" &lt; :distance ORDER BY \"</span> <span class=\"token operator\">+</span> <span class=\"token constant\">HAVERSINE_FORMULA</span><span class=\"token punctuation\">)</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Game</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findGamesWithInDistance</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"latitude\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">double</span> latitude<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"longitude\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">double</span> longitude<span class=\"token punctuation\">,</span>\n            <span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"distance\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">double</span> distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>MySQL</strong> <strong>Query</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> Game \n<span class=\"token keyword\">WHERE</span> \n<span class=\"token punctuation\">(</span><span class=\"token number\">6371</span> <span class=\"token operator\">*</span> acos<span class=\"token punctuation\">(</span>cos<span class=\"token punctuation\">(</span>radians<span class=\"token punctuation\">(</span><span class=\"token number\">37.4981646510326</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">*</span> cos<span class=\"token punctuation\">(</span>radians<span class=\"token punctuation\">(</span>latitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">*</span> cos<span class=\"token punctuation\">(</span>radians<span class=\"token punctuation\">(</span>longitude<span class=\"token punctuation\">)</span> \n<span class=\"token operator\">-</span> radians<span class=\"token punctuation\">(</span><span class=\"token number\">127.028307900881</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">+</span> sin<span class=\"token punctuation\">(</span>radians<span class=\"token punctuation\">(</span><span class=\"token number\">37.4981646510326</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">*</span> sin<span class=\"token punctuation\">(</span>radians<span class=\"token punctuation\">(</span>latitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">3</span>\n<span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> \n<span class=\"token punctuation\">(</span><span class=\"token number\">6371</span> <span class=\"token operator\">*</span> acos<span class=\"token punctuation\">(</span>cos<span class=\"token punctuation\">(</span>radians<span class=\"token punctuation\">(</span><span class=\"token number\">37.4981646510326</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">*</span> cos<span class=\"token punctuation\">(</span>radians<span class=\"token punctuation\">(</span>latitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">*</span> cos<span class=\"token punctuation\">(</span>radians<span class=\"token punctuation\">(</span>longitude<span class=\"token punctuation\">)</span> \n<span class=\"token operator\">-</span> radians<span class=\"token punctuation\">(</span><span class=\"token number\">127.028307900881</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">+</span> sin<span class=\"token punctuation\">(</span>radians<span class=\"token punctuation\">(</span><span class=\"token number\">37.4981646510326</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">*</span> sin<span class=\"token punctuation\">(</span>radians<span class=\"token punctuation\">(</span>latitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>위의 쿼리는 <strong>강남역으로부터 3KM 이내</strong>로 가장 가까운 게스트 모집글을 출력하는 쿼리입니다.</p>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/a14f20469c73afc54b26993b80832c3d/91425/3.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 9.411764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAi0lEQVR42h2OSQ6CQAAEeZHxYMRhlUXAQTIBBBPWZIw+wP8n5cCh06eqbisrSg7HE4lp2XTYYUzTvqibnrrtueWSIErxghjhhsTpnUq1qPpJVjxw/WiP414pSoU1TitJJhmN7DfMdAbW+sO8avT7i6yUkeRGGGELn+3AxgzTsg9eHB/HCzkLDz0t/AFWzkryKieOuwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='3' title='' src='/dev-blog/static/a14f20469c73afc54b26993b80832c3d/ca1dc/3.png' srcset='/dev-blog/static/a14f20469c73afc54b26993b80832c3d/e7570/3.png 170w,\n/dev-blog/static/a14f20469c73afc54b26993b80832c3d/f46e7/3.png 340w,\n/dev-blog/static/a14f20469c73afc54b26993b80832c3d/ca1dc/3.png 680w,\n/dev-blog/static/a14f20469c73afc54b26993b80832c3d/02d09/3.png 1020w,\n/dev-blog/static/a14f20469c73afc54b26993b80832c3d/9d567/3.png 1360w,\n/dev-blog/static/a14f20469c73afc54b26993b80832c3d/91425/3.png 1556w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<p>출력해보면 <strong><code class=\"language-text\">올댓 바스켓 대치점</code></strong> 의 경우 <code class=\"language-text\">강남역</code>과 약 <code class=\"language-text\">2.9KM</code>의 차이가 난다는 것을 확인해볼 수 있습니다. 그럼 네이버지도에서도 한 번 확인해볼까요?</p>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/34375b4db7adca41adc0bb38d3212622/c371b/4.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 19.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2klEQVR42h2Pu27EMAwE7/8/Lk2Q4hDkkvhgSWeJetGS3E2IFCxI7C5nbzkLpQijRXzY+Hi+o3NQRGi907TTW6K1Qnh5uztmTpxNGf1Em2lS5P7wRPPc6vZN/npQtl/6/mSGiB6Fq3Qb5YxCdTvZOYrzzOPF8A5xiSEN9Z7LHkk4KDlzO+6fXM5EObLGYJzKPIfNSa8d7RZaKzlaiASy7Gj5YVqja5m+i9Empla0JiM0qrGUZqYxJ2tN5lqohXYLm7brOElWJ+WGlN1o3oxGCNKJRlzkILfwr/8DOXku6hZTxD4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='4' title='' src='/dev-blog/static/34375b4db7adca41adc0bb38d3212622/ca1dc/4.png' srcset='/dev-blog/static/34375b4db7adca41adc0bb38d3212622/e7570/4.png 170w,\n/dev-blog/static/34375b4db7adca41adc0bb38d3212622/f46e7/4.png 340w,\n/dev-blog/static/34375b4db7adca41adc0bb38d3212622/ca1dc/4.png 680w,\n/dev-blog/static/34375b4db7adca41adc0bb38d3212622/02d09/4.png 1020w,\n/dev-blog/static/34375b4db7adca41adc0bb38d3212622/9d567/4.png 1360w,\n/dev-blog/static/34375b4db7adca41adc0bb38d3212622/c371b/4.png 1654w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<p>실제로 네이버지도에서 거리 측정을 해보아도 직선 거리가 <code class=\"language-text\">2.9km</code> 정도의 차이가 난다는 것을 확인해볼 수 있습니다.</p>\n<blockquote>\n<p>그럼 위와 같이 MySQL 쿼리에 거리 계산하는 식을 넣어서 구현하고 클라이언트에서 좌표 값(위도, 경도)과 특정 거리(3KM)만 넘겨주면 서버에서는 출력되는 데이터만 넘겨주면 되겠네요?</p>\n</blockquote>\n<p>그렇게 해도 데이터가 출력되는 것은 전혀 문제가 되지 않지만, <strong>항상 성능을 고려</strong>해보아야합니다. 위에서 구현한 대로 쿼리 문을 날리게 될 경우 수학적 연산이 들어간 쿼리를 요청해야하는데 테이블의 모든 레코드를 읽어서 비교해야하기 때문에 성능적으로 굉장히 좋지 못합니다. 경기의 개수가 무수히 많아진다면? 정말 아찔하겠죠?</p>\n<h2>2. 성능 테스트 및 개선</h2>\n<p>그래서 위에서 구현한 기능을 점진적으로 개선해보고자 합니다.</p>\n<h3>2.1 MySQL Point 자료형 사용하기</h3>\n<p><strong><code class=\"language-text\">double</code></strong> 타입인 <code class=\"language-text\">위도</code>, <code class=\"language-text\">경도</code> 컬럼, 그리고 하버사인 공식을 이용하여 조회할 때와 <code class=\"language-text\">point</code> 타입을 사용하여 MySQL 거리 관련 함수로 조회할 때의 성능 차이가 어느정도인지 또 어떻게 다른지에 대해서 이야기 해보도록 하겠습니다. 아래에서 나오는 테이블에는 더미데이터 <strong>10000개</strong>를 넣고 테스트했습니다.</p>\n<p><strong>2.1.1 위도, 경도 double 컬럼을 사용 할 때</strong></p>\n<p>위에서도 말씀드렸다시피 <code class=\"language-text\">위도</code>, <code class=\"language-text\">경도</code> 컬럼, 그리고 하버사인 공식을 이용하는 경우 MySQL 계산 함수를 통해 쿼리를 하게되는데 해당 쿼리가 테이블을 풀스캔 하다보니 데이터가 많으면 많아질 수록 속도가 느려질 수 밖에 없습니다. 매 레코드의 좌표 값과 특정 좌표 값과의 거리를 구하고 클라이언트에서 넘겨준 거리에 해당하는지 모두 확인해보아야하기 때문이죠.</p>\n<p><strong>game 테이블</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pickpledev<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>game<span class=\"token punctuation\">`</span></span>\n<span class=\"token punctuation\">(</span>\n\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>latitude<span class=\"token punctuation\">`</span></span>          <span class=\"token keyword\">DOUBLE</span>        <span class=\"token boolean\">NULL</span>     <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>longitude<span class=\"token punctuation\">`</span></span>         <span class=\"token keyword\">DOUBLE</span>        <span class=\"token boolean\">NULL</span>     <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략    \n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>game 테이블에 latitude와 longitude를 DOUBLE 형태로 값을 넣습니다.</li>\n</ul>\n<p><strong>1KM 반경 내 조회 쿼리</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token constant\">SELECT</span> <span class=\"token operator\">*</span>\n<span class=\"token constant\">FROM</span> <span class=\"token class-name\">Game</span> \n<span class=\"token constant\">WHERE</span> \n<span class=\"token punctuation\">(</span><span class=\"token number\">6371</span> <span class=\"token operator\">*</span> <span class=\"token function\">acos</span><span class=\"token punctuation\">(</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token function\">radians</span><span class=\"token punctuation\">(</span><span class=\"token number\">37.4981646510326</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">*</span> <span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token function\">radians</span><span class=\"token punctuation\">(</span>latitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">*</span> <span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token function\">radians</span><span class=\"token punctuation\">(</span>longitude<span class=\"token punctuation\">)</span> \n<span class=\"token operator\">-</span> <span class=\"token function\">radians</span><span class=\"token punctuation\">(</span><span class=\"token number\">127.028307900881</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">+</span> <span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token function\">radians</span><span class=\"token punctuation\">(</span><span class=\"token number\">37.4981646510326</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">*</span> <span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token function\">radians</span><span class=\"token punctuation\">(</span>latitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span>\n<span class=\"token class-name\">ORDER</span> <span class=\"token constant\">BY</span> \n<span class=\"token punctuation\">(</span><span class=\"token number\">6371</span> <span class=\"token operator\">*</span> <span class=\"token function\">acos</span><span class=\"token punctuation\">(</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token function\">radians</span><span class=\"token punctuation\">(</span><span class=\"token number\">37.4981646510326</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">*</span> <span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token function\">radians</span><span class=\"token punctuation\">(</span>latitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">*</span> <span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token function\">radians</span><span class=\"token punctuation\">(</span>longitude<span class=\"token punctuation\">)</span> \n<span class=\"token operator\">-</span> <span class=\"token function\">radians</span><span class=\"token punctuation\">(</span><span class=\"token number\">127.028307900881</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">+</span> <span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token function\">radians</span><span class=\"token punctuation\">(</span><span class=\"token number\">37.4981646510326</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n<span class=\"token operator\">*</span> <span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token function\">radians</span><span class=\"token punctuation\">(</span>latitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>game 테이블의 latitude와 longitude, 그리고 하버사인 공식을 이용하여 중심 좌표로부터 1KM 반경 내에 있는 game들을 불러옵니다.</li>\n</ul>\n<p><strong>결과값</strong></p>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/b6ed784d4e114a1b4225ef2f6e4e08eb/ab635/5.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 10%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdklEQVR42j2N2wrDMAxD+zUbDMpKL1vfR3OxHSdp//9bNKdlexAWB0vqPCW4yAicwFrO66JgCwTJFY7kz7359tv0cQH9MOH+6HEzDc8RefPoOGWQqIULtOwQC/9YrgfIvNaLNx/FhpNaOWN6rVY6npqXN4qP+AIBOEiu2YV16QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='5' title='' src='/dev-blog/static/b6ed784d4e114a1b4225ef2f6e4e08eb/ca1dc/5.png' srcset='/dev-blog/static/b6ed784d4e114a1b4225ef2f6e4e08eb/e7570/5.png 170w,\n/dev-blog/static/b6ed784d4e114a1b4225ef2f6e4e08eb/f46e7/5.png 340w,\n/dev-blog/static/b6ed784d4e114a1b4225ef2f6e4e08eb/ca1dc/5.png 680w,\n/dev-blog/static/b6ed784d4e114a1b4225ef2f6e4e08eb/02d09/5.png 1020w,\n/dev-blog/static/b6ed784d4e114a1b4225ef2f6e4e08eb/9d567/5.png 1360w,\n/dev-blog/static/b6ed784d4e114a1b4225ef2f6e4e08eb/ab635/5.png 2039w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<p>평균 duration: <code class=\"language-text\">0.125s</code></p>\n<p><strong>2.1.2 MySQL Point 컬럼과 공간 인덱스를 사용할 때</strong></p>\n<p><strong>game 테이블</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pickpledev<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>game<span class=\"token punctuation\">`</span></span>\n<span class=\"token punctuation\">(</span>\n\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략\n    <span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>location<span class=\"token punctuation\">`</span></span>  <span class=\"token keyword\">POINT</span> SRID <span class=\"token number\">4326</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span>\n\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략    \n\t\tSPATIAL <span class=\"token keyword\">INDEX</span> <span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>game 테이블을 생성할 때 POINT 라는 공간 자료형으로 컬럼을 생성합니다.</li>\n<li>이때 SRID 4326은 좌표의 측지계 즉, 지구의 공간정보의 위치와 거리를 나타내는 기준으로써 4326은 WGS84라는 의미합니다.</li>\n<li>SPATIAL INDEX로 공간 인덱스를 설정합니다.</li>\n</ul>\n<p><strong>1KM 반경 내 조회 쿼리</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">SELECT</span> id<span class=\"token punctuation\">,</span> main_address\n<span class=\"token constant\">FROM</span> game\n<span class=\"token constant\">WHERE</span> <span class=\"token class-name\">ST_Contains</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ST_Buffer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ST_PointFromText</span><span class=\"token punctuation\">(</span>'<span class=\"token function\">POINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">37.4981646510326</span> <span class=\"token number\">127.028307900881</span><span class=\"token punctuation\">)</span>'<span class=\"token punctuation\">,</span><span class=\"token number\">4326</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>game 테이블의 point 자료형과 MySQL 공간 관련 메서드를 이용하여 1KM 반경 내에 있는 game을 불러옵니다.</li>\n<li><strong>ST_Contains</strong>: 한 Geometry가 다른 Geometry를 완전히 포함하는지 확인하는 함수</li>\n<li><strong>ST_Buffer</strong>: 입력된 Geometry부터 지정된 거리만큼 Geometry를 둘러싸는 Geometry를 반환</li>\n<li><strong>ST_PointFromText</strong>: 주어진 WKT(공간 정보)를 포인트 객체로 반환하는 함수</li>\n</ul>\n<p><strong>결과 값</strong></p>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/ddeb59603ba7f6ace96e3eb2de8a83c8/cd35d/6.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 12.352941176470589%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAfklEQVR42h2MWw6CMBREWYyiFCiVlzT+GSv0TWH/axnr/TiZZE5mCqUttI/YrMdqHLQLsGHPJMp+WnCtGtxqTpSsRSMGvNUKxh/UXbKfxyfc54vif+D3g8YmH7uYENKBmM6cJ2b5QtVy1J0gGO8gxglqM+D9QN09e7lI+FXjB9HrRKKXd0QRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='6' title='' src='/dev-blog/static/ddeb59603ba7f6ace96e3eb2de8a83c8/ca1dc/6.png' srcset='/dev-blog/static/ddeb59603ba7f6ace96e3eb2de8a83c8/e7570/6.png 170w,\n/dev-blog/static/ddeb59603ba7f6ace96e3eb2de8a83c8/f46e7/6.png 340w,\n/dev-blog/static/ddeb59603ba7f6ace96e3eb2de8a83c8/ca1dc/6.png 680w,\n/dev-blog/static/ddeb59603ba7f6ace96e3eb2de8a83c8/02d09/6.png 1020w,\n/dev-blog/static/ddeb59603ba7f6ace96e3eb2de8a83c8/9d567/6.png 1360w,\n/dev-blog/static/ddeb59603ba7f6ace96e3eb2de8a83c8/cd35d/6.png 2035w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<p>평균 duration: <strong><code class=\"language-text\">0.025s</code></strong></p>\n<p><strong>인덱스</strong></p>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/67ee054d5d47515c16e83d02cb3f2c0d/5b400/7.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 31.176470588235293%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9ElEQVR42lVP7W6DMBDjXTa1BMgXISRQaKdqm7Tt/Z/H82UKYj9Od/H5bKfpjUe+3WHHCdoFxLQizBkhLfieEn7yDZ/zgqeP+AozfKfx4SbseUXeH+iNw8tFHdU4kvJ2h9IOY0yY8lLmed3wRvFEw50Gz3VHJO7diPeYsRDL2wORwmqwaHuDK6sxTNaReO01epI1q6OrpG3ZX5moE8yOUBTX5CvuxFTSXbhvB3NUI18dfCiCml0MhGhDLOItcXPCZS431he+0va/oBAHHoqgdCFJwiLAo2pU8TrLTvhnsb+EkoQEeRwJSRa8HghW8TpXc0l4rl8/V7uMZOm2agAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='7' title='' src='/dev-blog/static/67ee054d5d47515c16e83d02cb3f2c0d/ca1dc/7.png' srcset='/dev-blog/static/67ee054d5d47515c16e83d02cb3f2c0d/e7570/7.png 170w,\n/dev-blog/static/67ee054d5d47515c16e83d02cb3f2c0d/f46e7/7.png 340w,\n/dev-blog/static/67ee054d5d47515c16e83d02cb3f2c0d/ca1dc/7.png 680w,\n/dev-blog/static/67ee054d5d47515c16e83d02cb3f2c0d/5b400/7.png 770w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<p>EXPLAIN 으로 확인시 공간 인덱스를 타는 것을 확인해볼 수 있습니다.</p>\n<p><strong>결론</strong></p>\n<p>MySQL의 공간 자료형과 공간 인덱스를 사용함으로써 <code class=\"language-text\">0.125</code>s → <code class=\"language-text\">0.025</code>s로 <strong>약 5배 가량 쿼리 조회 성능 개선</strong></p>\n<p><strong>2.1.3 번외</strong></p>\n<p><strong>중심 좌표로 부터 1km 안에 있는 데이터 불러오기</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> id<span class=\"token punctuation\">,</span> ST_AsText<span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> location<span class=\"token punctuation\">,</span>\nST_Distance_Sphere<span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">,</span> ST_PointFromText<span class=\"token punctuation\">(</span><span class=\"token string\">'POINT(37.5 127.0)'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4326</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> distance\n<span class=\"token keyword\">FROM</span> game\n<span class=\"token keyword\">WHERE</span> ST_Distance_Sphere<span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">,</span> ST_PointFromText<span class=\"token punctuation\">(</span><span class=\"token string\">'POINT(37.5 127.0)'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4326</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">1000</span>\n<span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> distance<span class=\"token punctuation\">;</span></code></pre></div>\n<p>위와 같이 ST<em>Distance</em>Sphere 함수를 이용해서도 거리 계산을 하여 불러올 수 있는데 이건 앞에서 위,경도 컬럼을 이용해서 체크하는 방식과 비슷하게 동작합니다.</p>\n<p><strong>결과 값</strong></p>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/71f9d2eac0e0316614501dd1c67bac0b/d43ae/8.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 7.0588235294117645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAASklEQVR42mPw8vX/7+Mf+N/HL+C/L5D2RWIHBIf+9wsMAsv7BgT99waK+wFpOyeX/26e3v91DYz/6+gb/dfQNfjvbGnz39fN4z8A5p4kyltMip8AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='8' title='' src='/dev-blog/static/71f9d2eac0e0316614501dd1c67bac0b/ca1dc/8.png' srcset='/dev-blog/static/71f9d2eac0e0316614501dd1c67bac0b/e7570/8.png 170w,\n/dev-blog/static/71f9d2eac0e0316614501dd1c67bac0b/f46e7/8.png 340w,\n/dev-blog/static/71f9d2eac0e0316614501dd1c67bac0b/ca1dc/8.png 680w,\n/dev-blog/static/71f9d2eac0e0316614501dd1c67bac0b/02d09/8.png 1020w,\n/dev-blog/static/71f9d2eac0e0316614501dd1c67bac0b/9d567/8.png 1360w,\n/dev-blog/static/71f9d2eac0e0316614501dd1c67bac0b/d43ae/8.png 2047w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<p><strong>평균 결과 값: 0.3s</strong></p>\n<blockquote>\n<p>왜 공간 자료형을 사용하고 ST<em>Distance</em>Sphere 함수를 사용하면 그냥 일반 위,경도 컬럼을 이용해서 처리하는 것 보다 느릴까요?</p>\n</blockquote>\n<p>그것은 <strong>ST<em>Distance</em>Sphere</strong> 함수는 적용된 인덱스를 사용하지 못하기 때문입니다. 적용된 인덱스를 사용하지 못하더라도 성능이 비슷해야하지 않을까 싶은데요. 사실 공간자료형은 Blob형태로 저장되기 때문에 일반 형태의 Double로 저장하는 것 보다 성능상 이점을 가지지 못합니다.</p>\n<h3>2.2 fetch join을 통한 Lazy Loading N+1 문제 방지</h3>\n<p>위에서는 공간 자료형을 사용하여 쿼리를 최적화했습니다. 물론 5배나 빨라졌지만 실제로 어플리케이션 단계에서 동작할 때 생각보다 느려서 무엇이 문제인지 고민해보니 불필요한 쿼리가 굉장히 많이 날라가고 있었습니다. 아래는 현재 문제가 되는 코드입니다.</p>\n<p><strong>Game</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PROTECTED</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Game</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseEntity</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략\n\n    <span class=\"token annotation punctuation\">@NotNull</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"host_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Member</span> host<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@NotNull</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"address_depth1_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AddressDepth1</span> addressDepth1<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@NotNull</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"address_depth2_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AddressDepth2</span> addressDepth2<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Embedded</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">GamePositions</span> gamePositions <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GamePositions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Embedded</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">GameMembers</span> gameMembers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GameMembers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>AddressDepth1, AddressDepth2, GamePositions, GameMembers 모두 FetchType이 Lazy로 설정되어있습니다.</li>\n</ul>\n<p><strong>GameSearchRepository</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Repository</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GameSearchRepository</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">JPAQueryFactory</span> jpaQueryFactory<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Game</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findGamesWithInDistance</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">Double</span> latitude<span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">Double</span> longitude<span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">Double</span> distance\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> pointWKT <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"POINT(%s %s)\"</span><span class=\"token punctuation\">,</span> latitude<span class=\"token punctuation\">,</span> longitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> jpaQueryFactory\n                <span class=\"token punctuation\">.</span><span class=\"token function\">selectFrom</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token function\">isWithInDistance</span><span class=\"token punctuation\">(</span>pointWKT<span class=\"token punctuation\">,</span> distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token function\">getOrderByDistance</span><span class=\"token punctuation\">(</span>pointWKT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">BooleanExpression</span> <span class=\"token function\">isWithInDistance</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> pointWKT<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Double</span> distance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Expressions</span><span class=\"token punctuation\">.</span><span class=\"token function\">booleanTemplate</span><span class=\"token punctuation\">(</span>\n                <span class=\"token string\">\"ST_Contains(ST_Buffer(ST_GeomFromText({0}, 4326), {1}), point)\"</span><span class=\"token punctuation\">,</span>\n                pointWKT<span class=\"token punctuation\">,</span>\n                distance\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">OrderSpecifier</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Double</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getOrderByDistance</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> pointWKT<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Expressions</span><span class=\"token punctuation\">.</span><span class=\"token function\">numberTemplate</span><span class=\"token punctuation\">(</span>\n                        <span class=\"token class-name\">Double</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token string\">\"ST_Distance_Sphere(point, ST_GeomFromText({0}, 4326))\"</span><span class=\"token punctuation\">,</span>\n                        pointWKT\n                <span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">asc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>특정거리안에 있는 게임들을 불러올 때 findGamesWithInDistance 메서드를 호출하는데 해당 메서드 안에 join 없이 쿼리를 날리고 있는 것을 보실 수 있습니다.</li>\n</ul>\n<p><strong>GameResponse</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Builder</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PRIVATE</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GameResponse</span> <span class=\"token punctuation\">{</span>\n\n\t  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">GameResponse</span> <span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Game</span> game<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MemberResponse</span><span class=\"token punctuation\">></span></span> memberResponses<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">GameResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">id</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">content</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">playDate</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getPlayDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">playStartTime</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getPlayStartTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">playEndTime</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getPlayEndTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">playTimeMinutes</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getPlayTimeMinutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">mainAddress</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getMainAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">detailAddress</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getDetailAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">latitude</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getPoint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getY</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">longitude</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getPoint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getX</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">viewCount</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getViewCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">cost</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getCost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">memberCount</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getMemberCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">maxMemberCount</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getMaxMemberCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">host</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MemberResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getHost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// lazy</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">addressDepth1</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getAddressDepth1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// lazy </span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">addressDepth2</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getAddressDepth2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// lazy</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">positions</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span><span class=\"token function\">getPositions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">members</span><span class=\"token punctuation\">(</span>memberResponses<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>MemberResponse</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Builder</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PRIVATE</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MemberResponse</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">MemberResponse</span> <span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Member</span> member<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">MemberResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">id</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">email</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getEmail</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">nickname</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getNickname</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">introduction</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getIntroduction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">profileImageUrl</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getProfileImageUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">mannerScore</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getMannerScore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">mannerScoreCount</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getMannerScoreCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">addressDepth1</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getAddressDepth1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// lazy</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">addressDepth2</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getAddressDepth2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// lazy</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">positions</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">.</span><span class=\"token function\">getPositions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// lazy</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>findGamesWithInDistance 메서드를 통해 쿼리로 반환된 결과 값이 <strong>GameResponse에 MemberResponse</strong>가 포함되어 클라이언트한테 응답하는데요. 여기서 문제가 발생합니다. Lazy로 되어있는 Entity 객체에서 get으로 값을 불러올 때 select문을 호출하게 되는데 만약 조회되는 game이 100개라면 각각 lazy되어있는 필드마다 100번씩 호출되는 것이죠. 1개의 API를 요청하는데 select 쿼리가 100개 혹은 1000개가 나온다면.. 생각만 해도 끔찍합니다.</p>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 298px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/4186986b804284ae8bedc2ad347ff9ce/c9fe3/9.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 12.352941176470589%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdklEQVR42h3Lyw7DIBBD0fz/J3ZXRZHaiPAYhiFQ0G3E4ixsy1tImf34oNb4Ok9MhT053vHkEI/endMFgujKe3Rcpkg2fBCcKi93LLk1tlqfwV+MMRBJmBmxJsJDmjLnxEqh3vU5FKRmtBu9t9Vbr7gSlt8c/AEy9pk4ChFdiAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='9' title='' src='/dev-blog/static/4186986b804284ae8bedc2ad347ff9ce/c9fe3/9.png' srcset='/dev-blog/static/4186986b804284ae8bedc2ad347ff9ce/e7570/9.png 170w,\n/dev-blog/static/4186986b804284ae8bedc2ad347ff9ce/c9fe3/9.png 298w' sizes='(max-width: 298px) 100vw, 298px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<p>10만개의 더미 데이터를 넣고 특정 좌표를 기준으로 3KM 이내에 있는 API를 요청했을 때 응답 시간입니다. 평균적으로 <code class=\"language-text\">1.2초</code> ~ <code class=\"language-text\">1.8초</code> 사이로 나왔습니다.</p>\n<p>이 것을 해결하기 위한 방법으로는 fetch join이 있습니다. sql에서 제공하는 조인은 아니고 JPQL에서 성능 최적화를 위해 제공하는 기능으로 연관된 엔티나 컬렉션을 한 번에 같이 조회하는 기능입니다.</p>\n<p><strong>GameSearchRepository(fetch join 적용 후)</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GameSearchRepositoryImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">GameSearchRepository</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">JPAQueryFactory</span> jpaQueryFactory<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Game</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findGamesWithInDistance</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">Double</span> latitude<span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">Double</span> longitude<span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">final</span> <span class=\"token class-name\">Double</span> distance\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> pointWKT <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"POINT(%s %s)\"</span><span class=\"token punctuation\">,</span> latitude<span class=\"token punctuation\">,</span> longitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> jpaQueryFactory\n                <span class=\"token punctuation\">.</span><span class=\"token function\">selectFrom</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">)</span>\n                <span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span>host<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchJoin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span>addressDepth1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchJoin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span>addressDepth2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchJoin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span>game<span class=\"token punctuation\">.</span>gameMembers<span class=\"token punctuation\">.</span>gameMembers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchJoin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token function\">isWithInDistance</span><span class=\"token punctuation\">(</span>pointWKT<span class=\"token punctuation\">,</span> distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token function\">getOrderByDistance</span><span class=\"token punctuation\">(</span>pointWKT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>생략<span class=\"token operator\">*</span><span class=\"token operator\">*</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같이 적용하여 game을 조회할 때 연관된 엔티티나 컬렉션을 모두 조회해옵니다. 이때 무조건 fetch join을 붙여서는 안됩니다! 만약 fetch join하는 테이블의 데이터를 실제로 사용하지 않는다면 불필요한 데이터까지 긁어오는 것이니까요!</p>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 294px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/29604f213d52989e4a820f19d103ac3a/b27a5/10.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 11.176470588235293%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdklEQVR42h2NQQ4CIRAE/f8fPalRV5YdBgYYJCkXb9WdSvclxkgIgdYai3vrvHLgrhubHbg7cghWK4+88S476kY9s6bEbsIzf7jGG/XbuagqIsIYg3QKa/ioSjjF1AtzTsyM1jt7FWJTile8OyWXP69uHfkc/ABuEZmNqjw3XgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='10' title='' src='/dev-blog/static/29604f213d52989e4a820f19d103ac3a/b27a5/10.png' srcset='/dev-blog/static/29604f213d52989e4a820f19d103ac3a/e7570/10.png 170w,\n/dev-blog/static/29604f213d52989e4a820f19d103ac3a/b27a5/10.png 294w' sizes='(max-width: 294px) 100vw, 294px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<p>위에서 했던 테스트랑 동일하게 10만개의 더미 데이터를 넣고 특정 좌표를 기준으로 3KM 이내에 있는 API를 요청했을 때 응답 시간입니다. 평균적으로 <code class=\"language-text\">0.3초</code> ~ <code class=\"language-text\">0.4초</code> 사이로 나왔습니다.</p>\n<p><strong>결론</strong></p>\n<p>해당 API에 대한 명세가 game이 가지고 있는 모든 연관 관계 데이터를 응답해야했기 때문에 fetch join을 해도 되는 상황이라 판단했습니다. 그렇게 fetch join을 적용 함으로써 적용 전 <code class=\"language-text\">1.2초</code> ~ <code class=\"language-text\">1.8초</code>에서 적용 후 <code class=\"language-text\">0.3초</code> ~ <code class=\"language-text\">0.4초</code>  <strong>약 4배 정도 성능 개선</strong>되었습니다. </p>\n<h3>2.3 batch size 조절을 통한 N+1 문제 방지</h3>\n<p><strong>Game</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PROTECTED</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Game</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseEntity</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략\n\n    <span class=\"token annotation punctuation\">@NotNull</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"host_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Member</span> host<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@NotNull</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"address_depth1_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AddressDepth1</span> addressDepth1<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@NotNull</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"address_depth2_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AddressDepth2</span> addressDepth2<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Embedded</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">GamePositions</span> gamePositions <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GamePositions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Embedded</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">GameMembers</span> gameMembers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GameMembers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Game에 있는 GamePositions와 GameMembers는 여기에 적혀있진 않지만 <code class=\"language-text\">@OneToMany</code>로 연관 관계를 맺고 있습니다. <code class=\"language-text\">@ManyToOne</code>처럼 fetch join을 여러개 할 수 있다면 좋겠지만 <code class=\"language-text\">@OneToMany</code>로 이루어진 필드의 경우 Hibernate의 PersistenceBag으로 이루어져있기에 여러개로 fetch join이 불가능합니다. <a href=\"https://github.com/Hchanghyeon/dev-troubleshooting/blob/main/%5B%EC%98%88%EC%99%B8%5D%20Fetch%20%EC%A1%B0%EC%9D%B8%EC%8B%9C%20%EB%B0%9C%EC%83%9D%ED%95%98%EB%8A%94%20MultipleBagFetchException%20%ED%8A%B8%EB%9F%AC%EB%B8%94%20%EC%8A%88%ED%8C%85.md\">참고</a></p>\n<p>그래서 <code class=\"language-text\">@OneToMany</code>가 2개 이상인 엔티티의 경우 1개만 fetch join을 걸 수 있고 나머지는 batch size 조절을 통하여 N+1 문제를 방지할 수 있습니다.</p>\n<blockquote>\n<p><strong>batch size란?</strong></p>\n</blockquote>\n<p>batch size는 JPA에서 성능 개선을 위한 옵션 중 하나로 다수의 프록시 객체를 조회할 때 WHERE 절이 여러개의 SELECT 쿼리들을 하나의 IN 쿼리로 만들어서 질의할 수 있게 해줍니다. 만약 game을 조회했는데 gamePositions의 size가 10이라면 10번 쿼리를 날려야하는데 이것을 IN으로 묶어서 쿼리를 보내주게 되는 것이죠!</p>\n<p><strong>GamePositions</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Embeddable</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GamePositions</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token annotation punctuation\">@BatchSize</span><span class=\"token punctuation\">(</span>size <span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span>\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"game\"</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PERSIST</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REMOVE</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> orphanRemoval <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">GamePosition</span><span class=\"token punctuation\">></span></span> gamePositions <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> 생략\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위 처럼 <code class=\"language-text\">@BatchSize(size = 1000)</code>지정해주시면 size를 지정한 만큼 IN 쿼리 안에 들어가게 됩니다. 저는 실제로 매 요청시마다 나오는 데이터가 많다고 가정하고서 진행했기 때문에 1000으로 했지만 상황에 따라서 유동적으로 바꿔주시는게 좋을 것 같습니다. </p>\n<p><strong>적용 후 쿼리</strong></p>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/65c2f6744d3a8fe5f833a14ccb3bf974/61d11/11.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 58.235294117647065%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVR42qWSSQ7CMAxFcxDomGZoxhYqBAgQ9z/UJw5CSOxIFk8ZFk/+tpmIJ7iwwLiAgUvs2x5NNxTDpNJYDhukNkkoqmRZaH3E+XrH7fHEdrqg7cc6IdcO2jiQWGpbX6EMW+6fmt9iir5rutzLEthkFszWYzYeXBlwqTFOsoh+nJIwXeK6ISxHGJ+mnaK7dP6LDyuEmsFoVSgyVUmnsWVYF8GFIqHIjywlYSE01Cm1i1F2Wmz6qIEcWUgVfiLXQI5vZB+Lo/5GfgGpsV9jgk29qwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='11' title='' src='/dev-blog/static/65c2f6744d3a8fe5f833a14ccb3bf974/ca1dc/11.png' srcset='/dev-blog/static/65c2f6744d3a8fe5f833a14ccb3bf974/e7570/11.png 170w,\n/dev-blog/static/65c2f6744d3a8fe5f833a14ccb3bf974/f46e7/11.png 340w,\n/dev-blog/static/65c2f6744d3a8fe5f833a14ccb3bf974/ca1dc/11.png 680w,\n/dev-blog/static/65c2f6744d3a8fe5f833a14ccb3bf974/61d11/11.png 713w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<h3>2.4 성능 개선 후기</h3>\n<p>예전에는 기능을 구현하기만 하면 된다고 생각했는데 수 많은 요청과 크고 많은 데이터들 때문에 최적화하는 것이 필수가 된 것 같습니다. 찾아보니 생각보다 최적화 할 수 있는 방법은 많았고 실제로 최적화 하기전과 최적화 한 후의 결과 값을 보니 최적화하면 성능적으로 정말 많이 좋아지고 중요하다는걸 많이 느끼게되었습니다.</p>\n<h2>기타</h2>\n<p>개발 관련 오픈 채팅 톡방에서 어떤 분께서 Point 관련된 내용으로 질문하셨었는데 때 마침 공부를 끝내고 적용을 마친상태라 제가 도와드릴 수 있을 것 같아 개인 오픈 톡방으로 옮겨 질문자 분께 질문을 받았습니다.</p>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 357px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/f644675e72e5f9a3aa9ec99fabe8ff34/e07d4/12.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 28.235294117647058%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABOElEQVR42n1R22rCUBDMN5SSmJsxmItNooZIITcSFOlDISBUVKJoxaIWyXP/pT87zS61j30Ydidnz2TmrPD5/oInL0CaJJhMJojjGJqmQRRFdDodSJL0L2hGluW/Knx/vSKMnuH7HkajEaIoguu6sG0b/X4fjuNwb1kW1zvoO80ZhsFCuq5DVVUIWehAUTVUVYWmaXA+n3E6nXC5XLgej0fcbjdcr1ccDgfs9/vfmQ/mZCJp002nUzYjPDyKUBSldehjPB4jCALuCdTTBcL9fDgctpxqgMHARbfbhWmanKbX60FQFZkF5/M5/325XGK32zHqusZ6vcZms2G+Wq2w3dZYLN5Q5D6S2GxjGq2ozm9IECg/CdJCyHaWZSjLEkVRMO58NpshTVPkec6L8zwfYRiye3JNOrSUHyjawPYnefoRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='12' title='' src='/dev-blog/static/f644675e72e5f9a3aa9ec99fabe8ff34/e07d4/12.png' srcset='/dev-blog/static/f644675e72e5f9a3aa9ec99fabe8ff34/e7570/12.png 170w,\n/dev-blog/static/f644675e72e5f9a3aa9ec99fabe8ff34/f46e7/12.png 340w,\n/dev-blog/static/f644675e72e5f9a3aa9ec99fabe8ff34/e07d4/12.png 357w' sizes='(max-width: 357px) 100vw, 357px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 352px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/6eec3eae4895cd05e1686423cdeb9baf/3a2f8/13.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 128.23529411764707%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAADdUlEQVR42pVV2VIaQRTlD5LCXdxYh2GZAXoYgRkQcCkLKyqWWmVpuZQLpQ95yVse8xX5hnxCnvML+Z6TexqGGAE1D7e6e5g5fe45p5vQt6cevn/9AjuXg+u6UKqEgm1jbm4OCwvzUgsjNT8/r2vcb6FfPz7j988e6q6HaCqFdDaHlGkisrSESCSCxcVFRFgyf1ljAVuNPPy6hdXVGMrNTahaHarqo6QczdQtO3BUEapYQLFYgm1ZsCwbZiajN3vJNBQOz+LjhynEEwlsdz6h2d7CRrMNR9rP57KwBJQAlgaykM/nkRN5TOmCACsrK1heXh4ChyKR/i7xRBKN1ib8RgsNAVRlF1n5kADDEsCcjNwkk83q76rVqjAvYnZ2VjMOEZUGxONxAWrBa2yg4nmoeXXU/Docz4eSuZLRrVRRHYyFUkkzWltbE7lW/zLUgLKIyQ+eUqjKiyqfQyZtIiM6JaS1ZLY/GmlDt50VdmnDEEZ9Ms91DAUxoBbrYkBdWvDW17E+KLbkOmWZuyiXy4hGo9rhJUnBWJcDQArbPTrC3d0drq6vcXl5iZubG72+uLjA/f09Tk9PkRDzqNc4sBFAupcbGBG4yjVHQ1rkO5PyN7bl/f19XA/YkdHt7S3Oz8/13Pd9zMzMvAo2wrBQKKAkpgSjLfHgnLFgCt4CG2F4cnKCx8dHPD094erqShfZHR8f61b75/s/GFKrgNVzLTln1gjK9xjgNwH5wdHAZbr58PCAs7Mz7TR1pdO9Xg87Ozvvb5m6MWtKAl6pVPTck1Ojsyhnu1ar6Q7e3XKn09EOU0uy5Mi2w+GwdnhqaurVDI4Aks3u7q6OyNbWFlqtlr5Vgri8lcERDXnUGo0Gut0utre39UiHDw8P9TqZTE68qcdqSK3a7bYGoPg06eDgQEvRajZ1FoPLYOJfQDBhOzz4ZMqDzw04sigHn8disWHx3YmAvL6icn3Ryaw4a9Y8mOJyRhhnZDTFXVZanqdlnbctnQCSoEnPA/+PhoyEKWXIUUtLuIMySkWpEtJShqx5HzLw/JYpoHEEHd7YAaByHFiOgq36ZbGEtSWs9CimWcKMZ5uZJQhPFS/i6elpjTP8C6AmNYkNI8P4sBjuulz5dXnmS8v+IOR8hy1TS/4FsLgBr7ghQ4qfMlL64XuKFy3bpUxkvLe3pzf7AxLOBntzG6nYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='13' title='' src='/dev-blog/static/6eec3eae4895cd05e1686423cdeb9baf/3a2f8/13.png' srcset='/dev-blog/static/6eec3eae4895cd05e1686423cdeb9baf/e7570/13.png 170w,\n/dev-blog/static/6eec3eae4895cd05e1686423cdeb9baf/f46e7/13.png 340w,\n/dev-blog/static/6eec3eae4895cd05e1686423cdeb9baf/3a2f8/13.png 352w' sizes='(max-width: 352px) 100vw, 352px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 346px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/178ae643dd1636ad5aa3b43b161221e8/44e6f/14.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 120.58823529411767%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEfklEQVR42p2TWUxcZRTH79yZAWZglk6HmXtnBirIng4zrCNCAikMoDaGFCRiSKAggdCHvpiaKppa49IaMJpoGi20xULasrWUAsoidqOUltJGWqqF2lpjfHF90Bfz93zfZTpQlzQ+/HLOt9z/Pct3BFmWwXA6ZayzOFCYb8VUrxZjR0IwfDgEkz1anBnQ8r0v+rT4nNl+srQ/flSLyWNajBzW4vwJDfa+YoCwWtBoduDpUitunRNx5TMRl0dEXBsX8dVZEfO0vnBSjZlTGswOazA9qCExDe1pMHFUg6tjIvbtjQgKOhyK6IYNMtJS7cjw2pGZZke6xw6vW7ED7TqKKoQIJbFQbsePKHZmKAS7dxiDgna7jHCDE7pwJ0LCFLShQRumd+IiRTc3qsLCpBIxi/76lAqXhkUsnxfQ+X44BBaZzSYjMV7C6y8a0LorgmpBtETgnVcVmM/o/lCP4wf06P1Yj779evR3EO169Hykx0iXDju2mSE4SdBCzfBl27A0p8K9SwK+nRVw87SA5QvkzxGXBfywIODePO1NC1RT2qN7318RsER3vpkR8PttAT0H9SuC6x14LMuGxdMiblAKN8nODqsx1afmDfplUcSPCyJ+vrECrX9dVPyfrtMZ8eddFQ69F67UUJJkREdLeNJvxVPFVry724DR7jCcOKjjDHbqcJIYWrEBn/OJcmeiJww7t5uDTWGiZkqdNaH/kI6ionQovTsr6V8dU+HaGGuIQM1Q4eszAvkqykjAlxNUKrrX/YE+KBh4i0x4M0XZVGPC1ioTaipN2NNiwECHUvwH6d2v2FMU6QvN5rWCgfdoMkuItMUhKjoRekMi9rUZ8dsSNYWasDyjcOeigO/mlaawLP64K+DYAf3fBTmSHSkpifB6NiI52Y2tz9nR9loE3nrZiDdfUnhjpxFvtxiVPfJbdxlQ/cx66rLTCRfh4NE57iNJNorUBneKhUZLi9EuZW4/7VJml/mjK/5Qp5aPYkcbddlkWUczbKZJsSMyMpIjSRJ8vmxsdGeg1O/GNM3r2eNqmm1iVE0To6ZJUdM+MajGOTq7PS2ivZUEK0s2o6H8WTwaGwu3200pJiMpKQkscgaLNjpaRnycjNiYIDGPyPRNkJgYpf7C4sge3BrbjicKipDq9cCTmopUIhCxUlcnH08276uxrYKt2V1hW10+nq97HIlxCfAX+1FbW4uKigpUV1dzf8uWcsTHx1MZ7DyC/4ILGs2RMJpsPL3c3FyUlpYiPz8fJSUlKCoqQkFBAWKpHKyu//giHkBwuZxcPSoqCps2bUJ5eTnKysp4HS0WC6Vqeyih+4LK2ElcMC8vD36/H4WFhTxNJshq+b8FWcrFxcVckFmWPvsJO5NXvdOHEnS5XLxugaZUVVVxmDg7t1qta97p6iH41wjT0tKQnZ2N9PR0ZGVlITMzExkZGTxKn8+HnJwcTkJCAhdm9Q2UhGkw1giyZjQ2NvInU1dXh/r6elRWVqKpqQk1NTVobm5GQ0MD/5HH44HX6+XNY6Lse/ZS/gKwvGpq4D6eEgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='14' title='' src='/dev-blog/static/178ae643dd1636ad5aa3b43b161221e8/44e6f/14.png' srcset='/dev-blog/static/178ae643dd1636ad5aa3b43b161221e8/e7570/14.png 170w,\n/dev-blog/static/178ae643dd1636ad5aa3b43b161221e8/f46e7/14.png 340w,\n/dev-blog/static/178ae643dd1636ad5aa3b43b161221e8/44e6f/14.png 346w' sizes='(max-width: 346px) 100vw, 346px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 345px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/dev-blog/static/8668bf5f37b6fd3d02d39eeaeca1be1a/fa8f5/15.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 37.05882352941176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABTUlEQVR42nWRW06DQBSGWQMBBgZLb4QGCqG0hba2XjA+qA9GY2LSWgOW9K1WFuGjG3AvLsF9uIxf5ySY1sSHj/9MMufkm4P0dHuDj/c33F+eI4z6GPT7SJIEjUYDiqJA0zSCMbaXFbqu7yG9lg/4+izw/HgF2/EwHiU00Pd9dLtdStd1CXH+m81mE5xzWJaFWq0GybEtHJ0OwE0Ts9kM2+0W6/Uai8UCq9WK6jzPkWUZyrKkerPZ0Hm5XCKKIsRxjDRNMRwOIWlMhywr9BTP8+hCGIYIgoBSIGza7TYcxyE6nc5vXa/XaT0CMuTcgHlg0sDR4QRZnpHZfD5HURRkYds2Wq0WNZk/L1FVdW+HolekYRiQxEfAdIZpFOPs+ATjyYT0e70eIYwqa2Eq7ou9Vb270EBucMhMxcv0GnfpBdzAJytZlslm989WJv/xDRBR1vaw91miAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='15' title='' src='/dev-blog/static/8668bf5f37b6fd3d02d39eeaeca1be1a/fa8f5/15.png' srcset='/dev-blog/static/8668bf5f37b6fd3d02d39eeaeca1be1a/e7570/15.png 170w,\n/dev-blog/static/8668bf5f37b6fd3d02d39eeaeca1be1a/f46e7/15.png 340w,\n/dev-blog/static/8668bf5f37b6fd3d02d39eeaeca1be1a/fa8f5/15.png 345w' sizes='(max-width: 345px) 100vw, 345px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<p>Point 자료형에 대한 insert가 안된다고 하셨었는데 에러 메시지를 보니 ST_GeomFromText를 이용해서 변환되지 않고 들어가는 문제 같았습니다. 해당하는 MySQL 메서드를 이용하기 위해서는 그에 맞는 dialect를 적용하고 해당 메서드가 지원되는 hibernate 의존성을 추가해야될 것 같아서 의존성 버전과 dialect를 맞춰달라고 말씀드렸고 그 결과 정상적으로 돌아가신다고 하시네요! 확실히 제가 모르는 것을 배우고 그것을 또 모르는 사람에게 알려주는 일은 정말 보람차고 즐거운 일 같아요 👍👍</p>","frontmatter":{"title":"중심 좌표로부터 특정 거리에 속하는 데이터 불러오기","date":"May 18, 2024","update":"May 18, 2024","tags":["Pickple","성능개선","MySQL","공간 자료형","공간 인덱스","하버사인","백엔드","BatchSize"],"series":"Pickple 프로젝트 트러블 슈팅"},"fields":{"slug":"/15/","readingTime":{"minutes":19.825}}},"seriesList":{"edges":[{"node":{"id":"60820b8c-1f49-5d0c-b827-b5963accf653","fields":{"slug":"/6/"},"frontmatter":{"title":"소셜 최초 로그인시 회원가입 추가 정보를 받는 로직에 대한 고민"}}},{"node":{"id":"95139dc9-c381-5d58-bd62-4451dbd3305f","fields":{"slug":"/15/"},"frontmatter":{"title":"중심 좌표로부터 특정 거리에 속하는 데이터 불러오기"}}}]},"previous":{"fields":{"slug":"/13/"},"frontmatter":{"title":"[OMG-6] 나 백엔드인데 프론트(?)도 할 수 있다."}},"next":{"fields":{"slug":"/16/"},"frontmatter":{"title":"[OMG-8] 일일 캐릭터 조회 랭킹 Redis Sorted Set으로 개선하기"}}},"pageContext":{"id":"95139dc9-c381-5d58-bd62-4451dbd3305f","series":"Pickple 프로젝트 트러블 슈팅","previousPostId":"8d0f272b-8f16-5116-b0ac-6013f542a633","nextPostId":"ebe5e8aa-b589-564e-bf4d-05307ef1b652"}},"staticQueryHashes":[],"slicesMap":{}}