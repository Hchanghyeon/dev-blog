---
title: "μ„λ²„ μ ‘μ†μ΄ μ• λ  λ• ν•΄λ³Ό μ μλ” tcpdumpλ¥Ό μ΄μ©ν• νΈλ¬λΈ” μν… λ°©λ²•"
description: "κΈ°λ³Έμ μΈ λ„¤νΈμ›ν¬μ™€ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ„λ²„λ΅ μ ‘μ†μ΄ λμ§€ μ•μ„ λ• ν•΄λ³Ό μ μλ” νΈλ¬λΈ” μν… λ°©λ²•μ„ μ μ€ κΈ€μ…λ‹λ‹¤."
date: 2023-08-19
update: 2023-08-09
tags:
  - νΈλ¬λΈ” μν…
---

> - β μ•„λ‹! λ¶„λ… AWSμ— EC2λ¥Ό μƒμ„±ν•΄μ„ sshλ¥Ό μ¤ν”ν–λ”λ° μ™ μ ‘μ†μ΄ μ• λλ‚μ”?
> - β μ™Έλ¶€ ν™κ²½μ—μ„ IDCμ— μλ” νμ‚¬ μ„λ²„μ— μ ‘μ†μ΄ μ• λΌμ”!
> - β μ§‘ λ΅μ»¬ ν™κ²½μ—μ„ μ„λ²„λ¥Ό μ—΄μ–΄λ‘μ—λ”λ° μ™Έλ¶€μ—μ„ μ§‘μ— μλ” μ„λ²„κ°€ μ ‘μ†μ΄ μ• λΌμ”!

νΉμ‹ μ—¬λ¬λ¶„λ„ **μ„μ™€ κ°™μ€ μΌλ“¤μ„ κ²μ–΄ λ³΄μ‹  μ μ΄ μμΌμ‹ κ°€μ”?**

μ €λ” μ„μ™€ κ°™μ€ μΌλ“¤μ„ λ§μ΄ κ²μ–΄λ΄¤κ³ , ν•™κµλ¥Ό λ‹¤λ‹κΈ° μ „ λ³΄μ• νμ‚¬μ—μ„ **UTMμ΄λΌλ” λ°©ν™”λ²½ μ¥λΉ„λ¥Ό λ‹¤λ£¨λ©° κ³ κ°μ‚¬μ—μ„ μ„μ™€ κ°™μ€ λ¬Έμ λ“¤λ΅ μΈν•΄ μ§μ ‘ νΈλ¬λΈ” μν…ν• κ²½ν—**μ΄ λ§μ•μ—μµλ‹λ‹¤. 

μ €λ” κ·Έλ•λ§λ‹¤ κ°€μ¥ λ¨Όμ € ν™•μΈν•΄λ³΄λ” κ²ƒμ΄ μλ”λ°μ”! κ·Έκ²ƒμ€ λ°”λ΅ **λ„¤νΈμ›ν¬ ν¨ν‚·**μ…λ‹λ‹¤. μ„μ—μ„ λ§ν•λ” **μ ‘μ†**μ΄λΌλ” κ²ƒμ€ κ²°κµ­ `μ¶λ°μ§€`μ—μ„ `λ©μ μ§€`λ΅ μ ‘μ†ν•λ‹¤λ” κ²ƒμΌλ΅ κ²°κµ­ μ ‘μ†ν•  λ•λ” `μ¶λ°μ§€`μ—μ„ `λ©μ μ§€`λ΅ **μ ‘μ†μ„ μ„ν• ν¨ν‚·μ„ λ³΄λ‚΄κ² λ©λ‹λ‹¤**. μ΄κ²ƒμ€ λ‹¨μν SSH μ ‘μ†λΏλ§μ΄ μ•„λ‹λΌ **HTTP μ ‘μ†, MySQLμ μ„λΉ„μ¤ ν¬νΈμΈ 3306 ν¬νΈλ¥Ό μ ‘μ†ν•  λ•λ„ μ μ©λλ©° λ€λ‹¤μμ μ„λΉ„μ¤μ— μ μ©**λλ‹¤κ³  λ³΄μ‹λ©΄ λ  κ²ƒ κ°™μ•„μ”.

κ·ΈλΌ **νΈλ¬λΈ” μν…ν•λ” λ°©λ²•μ„ λ°°μ°κΈ° μ „μ— μ•μ•„λ‘λ©΄ μΆ‹μ€ λ‚΄μ©**μ— λ€ν•΄μ„ λ¨Όμ € κ°„λ‹¨ν•κ² λ§μ”€λ“λ¦¬κ³  λ„μ–΄κ°€λ„λ΅ ν•κ² μµλ‹λ‹¤.

### νΈλ¬λΈ” μν…μ„ μ„ν• λ°°κ²½ μ§€μ‹

#### κΈ°λ³Έμ μΈ λ„¤νΈμ›ν¬ ν™κ²½

![Alt text](./image-2.png)

λ³΄ν†µ μΌλ°μ μΈ λ„¤νΈμ›ν¬ ν™κ²½μ„ λ³΄λ©΄ μ§‘ PCμ—μ„ κ³µμ κΈ°λ¥Ό ν†µν•΄ μ™Έλ¶€ μΈν„°λ„·μ— μ ‘μ†ν•κ³  λ©μ μ§€μΈ μ„λ²„μ— μ ‘μ†ν•λ” λ°©μ‹μΌλ΅ μ΄λ£¨μ–΄μ Έ μμµλ‹λ‹¤. μ™Έλ¶€ μΈν„°λ„·μ€ **μλ§μ€ λΌμ°ν„°κ°€ μ„λ΅ μ—°κ²°λμ–΄ μλ” ν•νƒλ΅ μ§‘μ— μλ” PCμ™€ μ„λ²„κ°€ μ—°κ²°**λ  μ μλ” κ±°μ£ ! κ·Έλ ‡λ‹¤λ©΄ μ„λ΅ μ–΄λ–¤ λ°©μ‹μΌλ΅ ν†µμ‹ ν•λ” κ±ΈκΉμ”?


#### IPκ°€ ν¬ν•¨λ λ„¤νΈμ›ν¬ ν™κ²½

![Alt text](./image-3.png)
μ„λ΅ ν†µμ‹ ν•κΈ° μ„ν•΄μ„λ” **λ³„λ„μ μ£Όμ†**λ¥Ό κ°€μ§€κ³  μμ–΄μ•Ό ν•©λ‹λ‹¤. μ €ν¬κ°€ λ„¤μ΄λ²„ μ§€λ„ μ•±μ„ μΌμ„ λ©μ μ§€λ΅ κ° λ• μ¶λ°μ§€μ™€ λ©μ μ§€λ¥Ό μ…λ ¥ν•λ“― λ„¤νΈμ›ν¬ ν†µμ‹ λ„ λ§μ°¬κ°€μ§€λ΅ κ° μ¥λΉ„λ§λ‹¤ λ³„λ„μ κ³ μ  μ£Όμ†κ°€ ν•„μ”ν•λ©° μ¶λ°μ§€ μ£Όμ†μ—μ„ λ©μ μ§€ μ£Όμ†λ¥Ό λ°”λΌλ³΄κ³  κ²½λ΅λ¥Ό νƒμƒ‰ν•΄μ„ μ°Ύμ•„κ°€κ² λ©λ‹λ‹¤. **λ„¤νΈμ›ν¬μ—μ„λ” κ·Έ κ³ μ ν• μ£Όμ†λ¥Ό IP**λΌκ³  λ¶λ¬μ”!

μλ¥Ό λ“¤μ–΄ **192.168.0.100**μ΄λΌλ” μ§‘ PCμ—μ„ **123.122.111.100**μ΄λΌλ” μ™Έλ¶€ μ›Ήμ„λ²„λ¥Ό μ ‘μ†ν•λ‹¤κ³  κ°€μ •ν•΄λ³΄κ² μµλ‹λ‹¤.

> 1. 192.168.0.100μΈ μ§‘ PCμ—μ„ μ›Ή λΈλΌμ°μ €λ΅ 123.122.111.100μ΄λΌλ” μ›Ήμ„λ²„μ— μ ‘μ†ν•©λ‹λ‹¤. (μ‹¤μ λ΅λ” λ„λ©”μΈμ„ μ…λ ¥ν•λ” κ²½μ°κ°€ λ§κ² μ£ ? ν•μ§€λ§ λ„λ©”μΈλ„ μ‹¤μ λ΅λ” λ¨λ‘ IPλ΅ μ΄λ£¨μ–΄μ Έ μλ‹µλ‹λ‹¤!)
> 2. κ·ΈλΌ μ΄λ• 192.168.0.100μ΄λΌλ” μ§‘ PC(μ¶λ°μ§€)μ—μ„ ν¨ν‚·μ„ λ§λ“¤μ–΄ κ³µμ κΈ°μ GatewayμΈ 192.168.0.1λ΅ λ³΄λ‚΄κ² λκ³ ,μ§‘ PC IPμ€λ 192.168.0.100μ„ 223.194.166.251μ΄λΌλ” μ™Έλ¶€ IPλ΅ λ³€ν™μ‹μΌ μ™Έλ¶€ μΈν„°λ„·μΌλ΅ μ „λ‹¬ν•κ² λ©λ‹λ‹¤.(λ‚΄λ¶€ PCμ IPλ¥Ό κ³µμ κΈ°μ μ™Έλ¶€ IPλ΅ λ³€ν™ν•λ”μ΄μ λ” NATμ— λ€ν•΄μ„ μ°Ύμ•„λ³΄μ‹λ©΄ μΆ‹μ„ κ²ƒ κ°™μ•„μ”.)
> 3. μ΄λ• ν¨ν‚·μ—λ” λ©μ μ§€ IPκ°€ λ‹΄κ²¨ μλ”λ° μ΄ λ©μ μ§€ IPλ¥Ό ν™μ©ν•μ—¬ λΌμ°ν„°λ“¤μ΄ κ³„μ† κ²½λ΅ μ„¤μ •μ„ ν•μ—¬ 123.122.111.100μ΄λΌλ” μ„λ²„μ— λ„λ‹¬ν•  μ μκ² ν•΄μ¤λ‹λ‹¤.


μ΄λ ‡κ² κ°„λµν•κ² IPλ¥Ό ν†µν•΄ λ„¤νΈμ›ν¬μ—μ„ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ μ–΄λ–¤μ‹μΌλ΅ μ„λ΅ ν†µμ‹ ν•λ”μ§€μ— λ€ν•΄μ„ μ• μ μμ—λ”λ°μ”. μ—¬κΈ°μ„ μ¤‘μ”ν• κ²ƒμ€ 2λ²μ— λ‚μ™”λ **ν¨ν‚·**μ…λ‹λ‹¤. λ„¤νΈμ›ν¬μ—μ„ λ§ν•λ” ν¨ν‚·μ€ **μ»΄ν“¨ν„° λ„¤νΈμ›ν¬μ—μ„ μ „λ‹¬ν•λ” λ°μ΄ν„°μ ν•μ‹ν™”λ λΈ”λ΅**μ…λ‹λ‹¤. μ¦‰ ν΄λΌμ΄μ–ΈνΈμΈ 192.168.0.100 PCμ—μ„ μ›Ή μ„λ²„μΈ 123.122.111.100 μ„λ²„λ΅ μ›Ή νμ΄μ§€λ¥Ό μ”μ²­ν•  λ• νμ΄μ§€λ¥Ό λ°›μ•„μ¤λ” κ³Όμ •, μ”μ²­ν•λ” κ³Όμ • λ“± μ„λ΅ ν†µμ‹ μ„ ν•΄μ•Ό ν•κ³  μ΄ ν†µμ‹ μ— μ†΅μ‹ , μμ‹ λλ” λ°μ΄ν„°κ°€ λ°”λ΅ ν¨ν‚·μ΄λΌκ³  λ³Ό μ μμµλ‹λ‹¤.

#### 3way Handshake
μ§€κΈκΉμ§€ IPλ¥Ό ν†µν•΄ ν†µμ‹ ν•  λ•λ” ν¨ν‚·μ„ μ΄μ©ν•μ—¬ λ°μ΄ν„°λ¥Ό μ†΅, μμ‹ λ°›λ”λ‹¤κ³  ν–μµλ‹λ‹¤. κ·Όλ° μ΄ ν†µμ‹ μ„ ν•κΈ° μ„ν•΄μ„ κ·Έλƒ¥ ν¨ν‚·μ„ λ³΄λ‚΄κ³  λ°›μΌλ©΄ λμ΄ μ•„λ‹κΉ? μƒκ°μ΄ λ“¤ μλ„ μκ² μ§€λ§ μ‹¤μ λ΅λ” 3way HandshakeλΌλ” κ³Όμ •μ„ ν†µν•΄ λ¨Όμ € ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ μ—°κ²°λμ–΄μλ”μ§€ ν™•μΈν•λ” κ³Όμ •μ΄ μμµλ‹λ‹¤.

![Alt text](image-4.png)

**[μ¶μ² geeksforgeeks]**

**3way handshakeκ³Όμ •**

> 1. SYN : ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ™€μ μ—°κ²°μ„ μ„ν•΄ SYNμ΄λΌλ” ν”λκ·Έλ¥Ό λ³΄λ‚΄μ–΄ μ—°κ²° μ”μ²­μ„ λ³΄λƒ…λ‹λ‹¤.
> 2. SYN/ACK : μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ μ—°κ²° μ”μ²­μ„ λ°›μ•„ μ—°κ²°ν•  μ μλ‹¤κ³  νλ‹¨λλ©΄ SYN/ACK ν”λκ·Έλ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚΄μ¤λ‹λ‹¤.
> 3. ACK : ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ μ‘λ‹µμ„ ν™•μΈν•κ³  λ‘ λ‹¤ μ‹¤μ  λ°μ΄ν„° μ „μ†΅μ„ μ‹μ‘ν•  μ•μ •μ μΈ μ—°κ²°μ„ μ„¤μ •ν•©λ‹λ‹¤.

λ‹¤μ‹ μ •λ¦¬ν•΄λ³΄λ©΄ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ„λ²„λ΅ μ ‘μ†ν•  λ• IPλ¥Ό μ΄μ©ν•μ—¬ ν†µμ‹ μ„ ν•λ”λ° κ·Έλ• ν¨ν‚·μ„ ν†µν•΄ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•κ² λκ³  ν†µμ‹ μ„ μ—°κ²°ν•κΈ° μ „ 3way Handshakeλ¥Ό ν†µν•΄ μ—°κ²° μ”μ²­μ„ ν™•μΈν•  μ μλ‹¤κ³  λ³Ό μ μμµλ‹λ‹¤. μ΄λ• 3way Handshakeλ„ ν΄λΌμ΄μ–ΈνΈκ°€ SYN ν¨ν‚·μ„ μ„λ²„λ΅ λ³΄λ‚΄κ³ , μ„λ²„κ°€ SYN/ACK ν¨ν‚·μ„ λ‚ λ¦¬λ©° 3way Handshakeλ„ κ²°κµ­ ν¨ν‚·μ„ μ΄μ©ν• ν†µμ‹  μ¤‘μ— ν•λ‚λ΅ λ³Ό μ μμµλ‹λ‹¤.

![Alt text](image-5.png)

κ·ΈλΌ **ν†µμ‹ μ„ μ„ν•΄ κ°€μ¥ λ¨Όμ € λ°μƒν•λ” κ²ƒμ΄ SYN ν¨ν‚·**μΈ κ±°κ³  μ €ν¬λ” μ΄ **SYN ν¨ν‚·μ„ μ¶”μ **ν•λ‹¤λ©΄ μ„λ²„ μ ‘μ†μ΄ μ• λκ³  μλ” κµ¬κ°„μ„ μ• μ μμ§€ μ•μ„κΉμ”?

#### tcpdump
μ €ν¬λ” ν΄λΌμ΄μ–ΈνΈμ—μ„ μ„λ²„λ΅ μ”μ²­ν•λ” SYN ν¨ν‚·μ„ κ°€λ΅μ±„μ„ ν™•μΈν•κΈ° μ„ν•΄ **tcpdumpλΌλ” μ†ν”„νΈμ›¨μ–΄**λ¥Ό μ‚¬μ©ν•  κ²λ‹λ‹¤. tcpdumpλ” λ„¤νΈμ›ν¬μ—μ„ μ „μ†΅λλ” ν¨ν‚·μ„ κ°€λ΅μ±„μ„ ν‘μ‹ν•  μ μκ² ν•΄μ£Όλ” μ†ν”„νΈμ›¨μ–΄λ΅ λ€λ¶€λ¶„μ μ λ‹‰μ¤ κ³„μ—΄ μ΄μ μ²΄μ μ—μ„ μ‚¬μ© κ°€λ¥ν•©λ‹λ‹¤. μλ„μ°μ—μ„λ” **wireshark**λΌλ” ν”„λ΅κ·Έλ¨μ„ μ΄μ©ν•  μ μμΌλ©° ν„μ¬ μ§„ν–‰λλ” κ³Όμ •λ“¤μ€ tcpdumpλ¥Ό μ§€μ›ν•λ” μ λ‹‰μ¤ κ³„μ—΄ μ΄μ μ²΄μ μ— ν•΄λ‹Ήν•©λ‹λ‹¤. μ„¤μΉλ¥Ό μ μ™Έν• λ‚λ¨Έμ§€ κ³Όμ •μ€ MacOSμ—μ„ μ§„ν–‰λλ©° λ€λ‹¤μμ μ λ‹‰μ¤ κ³„μ—΄μ— λ„¤νΈμ›ν¬ κ΄€λ ¨λ μΈν„°νμ΄μ¤κ°€ μ„¤μΉλμ–΄μλ” κ²½μ° tcpdumpκ°€ κΉ”λ¦° κ²½μ°κ°€ λ§μµλ‹λ‹¤.

**μ„¤μΉ**
``` linux
// Ubuntu κΈ°μ¤€(λ‹¤λ¥Έ λ¦¬λ…μ¤ κ³„μ—΄λ„ λΉ„μ·ν• λ°©μ‹μΌλ΅ μ„¤μΉν•©λ‹λ‹¤.)
# apt install tcpdump
```

**λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤ μ΅°ν**

λ…ΈνΈλ¶μ„ κΈ°μ¤€μΌλ΅ μƒκ°ν•΄λ³΄μ•μ„ λ• λ…ΈνΈλ¶μ€ λ¬΄μ„ , μ μ„  2κ°€μ§€κ°€ μκ³  μ΄ 2κ°€μ§€μ— λ¨λ‘ IPλ¥Ό ν• λ‹Ήλ°›μ„ μ μμµλ‹λ‹¤. λ…ΈνΈλ¶μ—λ” μ μ„  λμΉ΄λ“, λ¬΄μ„  λμΉ΄λ“ 2κ°μ λμΉ΄λ“κ°€ μλ‹¤κ³  λ³Ό μ μμΌλ©° μΈν„°λ„·μ— μ—°κ²°λ λμΉ΄λ“λ¥Ό ν†µν•΄ ν¨ν‚·μ΄ λ‚κ°€κ² λ©λ‹λ‹¤. κ·ΈλΌ μ  λ…ΈνΈλ¶μ„ κΈ°μ¤€μΌλ΅ μ•μ•„ λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤. 

```
# ifconfig
```
![Alt text](image-7.png)

ifconfigλ¥Ό μ…λ ¥ν–μ„ λ• κ°€μ¥ μ™Όμ½μ„μ— `:` μ™Όμ½μ— μ“°μ—¬ μλ” κ²ƒμ΄ **λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤(λμΉ΄λ“)μ μ΄λ¦„**μ΄λ©° μ—¬λ¬ κ°κ°€ λ‚μ¤λ”λ° κ·Έ μ¤‘ **inetμ΄ μ…λ ¥λμ–΄μλ” κ³³μ΄ IPκ°€ λ¶€μ—¬λμ–΄ μ‚¬μ©**ν•κ³  μλ” κ³³μΌλ΅ λ³Ό μ μμµλ‹λ‹¤.(μ μ„ , λμ„  λ‘ λ‹¤ μ‚¬μ©ν•λ©΄ inetμ΄ μ ν€μλ” μΈν„°νμ΄μ¤κ°€ 2κ° μμ„ μ μμ!) μ €λ” en0μ΄λΌλ” λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤λ…μ„ κ°€μ§€κ³  μκ³  192.168.1.84λΌλ” IPλ¥Ό κ°€μ§€κ³  μλ„¤μ”!

**νΉμ • λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤μ—μ„ λ‚κ°€λ” ν¨ν‚· μ΅°ν**
```
# tcpdump -nni en0
```
μ„μ— μ ν λ…λ Ήμ–΄λ” en0μ΄λΌλ” λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤λ¥Ό κ°μ‹ν•΄μ„ μ‹¤μ‹κ°„μΌλ΅ μ¶λ ¥ν•κ² λ‹¤λ” λ»μ…λ‹λ‹¤.

-  `-i` : λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤λ¥Ό μ„¤μ •ν•λ” μµμ…
-  `-n` : ν• λ²μ nμ€ IP μ£Όμ†λ¥Ό μ΄λ¦„μΌλ΅ λ³€ν™ν•μ§€ μ•κ³  λ‘ λ²μ nμ„ μ…λ ¥ν•  κ²½μ° IPμ™€ ν¬νΈλ¥Ό μ΄λ¦„μΌλ΅ λ³€ν™ν•μ§€ μ•μµλ‹λ‹¤.

![Alt text](img1.png)

μ‹¤ν–‰ν•κ³  λ°”λ΅ μ·¨μ†λ¥Ό λλ¬ μΊ΅μ²λ ν¨ν‚·μ…λ‹λ‹¤. λΉ¨κ°„μƒ‰μΌλ΅ ν‘μ‹λ λ¶€λ¶„μ„ λ³΄λ©΄ **μ  λ…ΈνΈλ¶ λ¬΄μ„  λμΉ΄λ“μ— μ ν€μλ” IPμΈ 192.168.1.84λ²** `μ¶λ°μ§€`μ—μ„ **104.18.22.107 IPμ 443ν¬νΈμΈ** `λ©μ μ§€`λ΅ ν¨ν‚·μ΄ λ‚κ°€κ³  μλ” κ²ƒμ„ λ³Ό μ μμµλ‹λ‹¤. 443ν¬νΈλ” httpsλ΅ μ €λ” ν„μ¬ httpsλ΅ λμ–΄μλ” μ›Ήμ‚¬μ΄νΈλ¥Ό μ ‘μ†ν•΄ μκΈ° λ•λ¬Έμ— μ„μ™€ κ°™μ΄ ν¨ν‚·μ΄ λ‚μ¤κ² λλ” κ²λ‹λ‹¤. κ·Έ λ’¤μ— Flagsλ¥Ό λ³ΌκΉμ”? μ κ°€ μμ„Έν λ§μ”€λ“λ¦¬μ§„ μ•μ•μ§€λ§ SYN, ACKμ™€ κ°™μ€ ν”λκ·Έλ“¤μ΄ λ” μμµλ‹λ‹¤. [.]μ€ ACK Flagλ΅ λ΄λ„ λ¬΄λ°©ν•λ©° μ—°κ²° ν›„ ν†µμ‹ μ΄ μ΄λ£¨μ–΄μ§€κ³  μλ‹¤κ³  λ³΄λ©΄ μΆ‹μ„ κ²ƒ κ°™μ•„μ”. 

μ΄λ ‡κ² `μ¶λ°μ§€` IPμ—μ„ `λ©μ μ§€` IPλ΅ κ°€λ” ν¨ν‚·μ— **Flagκ°€ λ‹΄κ²¨**μμΌλ―€λ΅ μ–΄λ λ©μ μ§€ μ„λ²„λ¥Ό μ ‘μ†ν•  λ• **μ¶λ°μ§€ λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤μ—μ„ SYN ν¨ν‚·μ΄ λ©μ μ§€ IPλ΅ λ‚ μ•„κ°€λ”μ§€**, κ·Έλ¦¬κ³  μ„λ²„μ—μ„λ„ λ™μΌν•κ² **μ„λ²„μ μΈν„°νμ΄μ¤μ—μ„ ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ SYN ν¨ν‚·μ΄ λ“¤μ–΄μ¤λ”μ§€ ν™•μΈν•΄λ³΄λ©΄ μ—°κ²° μ”μ²­μ— λ€ν•΄μ„ νΈλ¬λΈ” μν…** ν•΄λ³Ό μ μμ§€ μ•μ„κΉμ”? 

κ·ΈλΌ  **μ •μƒ λ™μ‘μΌ λ•μ™€ λΉ„μ •μƒ λ™μ‘μΌ λ• κ°κ°μ„ μ–΄λ–»κ² ν™•μΈν•΄λ³Ό μ μκ³  μ–΄λ–¤ μ°¨μ΄**κ°€ μλ”μ§€ μ•μ•„λ΄…μ‹λ‹¤.

### μμ 

#### ν΄λΌμ΄μ–ΈνΈμ—μ„ μ •μƒμ μΌλ΅ μ„λ²„μ— μ ‘μ†λλ” κ²½μ°

![Alt text](image-8.png)

- **ν΄λΌμ΄μ–ΈνΈ PC** : 192.168.1.84
- **MySQL μ„λ²„** : 180.224.180.78


ν„μ¬ μ €λ” μΉ΄νμ— μκ³  μΉ΄ν λ¬΄μ„  μ™€μ΄νμ΄λ΅ λ°›μ€ **ν΄λΌμ΄μ–ΈνΈ PC IPλ” 192.168.1.84**μ΄κ³  μ§‘μ— ν…μ¤νΈλ¥Ό ν•κΈ° μ„ν•΄ μ—΄μ–΄λ‘” **MySQLμ„λ²„λ” 180.224.180.78λ²** μ…λ‹λ‹¤. μ  λ…ΈνΈλ¶μΈ 192.168.1.84μ—μ„ **MySQL Workbenchλ΅ μ§‘μ— μλ” 180.224.180.78μ„ μ ‘μ†**ν•΄λ³΄κ² μµλ‹λ‹¤. μ ‘μ†ν•  λ•λ” μ•„λμ™€ κ°™μ΄ λ…λ Ήμ–΄λ¥Ό ν†µν•΄ ν¨ν‚·μ„ μΊ΅μ²ν•΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤.

```
# tcpdump -nni en0 port 33306
```

λ…λ Ήμ–΄μ— portλ¥Ό μ…λ ¥ν•λ” κ²½μ° νΉμ • ν¬νΈλ¥Ό μ„ νƒν•΄μ„ μΊ΅μ²ν•  μ μμµλ‹λ‹¤.(μ§‘μ— μλ” MySQLμ„λ²„λ” ν…μ¤νΈ μ©λ„λ΅ 3306 ν¬νΈκ°€ μ•„λ‹ 33306ν¬νΈλ΅ μ¤ν”λμ–΄μλ” μƒνƒμ…λ‹λ‹¤.)


**ν΄λΌμ΄μ–ΈνΈμ—μ„ ν™•μΈν• tcpdump**
![Alt text](img2.png)

μ„ μ‚¬μ§„μ€ ν΄λΌμ΄μ–ΈνΈμ—μ„ μΊ΅μ²ν• ν¨ν‚·μΈλ° **192.168.1.84μ—μ„ 180.224.180.78μ 33306ν¬νΈλ΅ SYNν¨ν‚·**μ΄ λ‚κ°€λ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤. μ•„λ <b>Flag [S.]</b>μ κ²½μ° **SYN/ACK**λ¥Ό ν‘ν„ν•λ” λ»μ΄λ©° κ·Έ μ•„λ λ°”λ΅ <b>Flag [.]</b>μ΄ λ‚μ¨ κ²ƒμ„ λ³΄λ©΄ μ •μƒμ μΌλ΅ μ—°κ²°λ κ²ƒμ„ ν™•μΈν•΄λ³Ό μ μμµλ‹λ‹¤. κ·ΈλΌ λ°λ€νΈμΈ MySQLμ„λ²„μ—μ„λ„ ν™•μΈν•΄λ³ΌκΉμ”?

**μ„λ²„ λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤ ν™•μΈ**
![Alt text](image-9.png)

μ°μ„  MySQL μ„λ²„μ IPλ” **172.17.0.4**μ΄κ³  eth0μ΄λΌλ” λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤λ¥Ό μ΄μ©ν•κ³  μμµλ‹λ‹¤. μ„λ²„μ IPμΈ 180.224.180.78λ„ μ™Έλ¶€ IPμΌ λΏ NATκ°€ μ μ©λκ³  ν„μ¬ λ„μ»¤λ΅ λλ¦° MySQLμ΄κΈ° λ•λ¬Έμ— μ„μ™€ κ°™μ΄ 172.17.0.4λ΅ λ‚μ¤κ² λ©λ‹λ‹¤. μ¶λ°μ§€μ—μ„ λ³΄κΈ°μ—λ” μ„λ²„λ” **180.224.180.78** IPλ¥Ό κ°€μ§€κ³  μλ‹¤κ³  λ΄μ£Όμ‹λ©΄ λ  κ²ƒ κ°™μ•„μ”!



**μ„λ²„μ—μ„ ν™•μΈν• tcpdump**
```
# tcpdump -nni eth0
```
![Alt text](img3.png)

μ¶λ°μ§€ 172.17.0.1μ—μ„ 172.17.0.4μ 3306ν¬νΈλ΅ SYN ν¨ν‚·μ΄ λ“¤μ–΄μ¨ κ²ƒμ„ λ³΄μ‹¤ μ μμµλ‹λ‹¤. ν„μ¬ μ¶λ°μ§€ IPκ°€ μΉ΄ν μ™Έλ¶€ IPμΈ 39.115.214.146μΌλ΅ λ‚μ¤μ§€ μ•λ” μ΄μ λ” ν„μ¬ μ κ°€ λ„μ»¤λ¥Ό μ΄μ©ν•΄μ„μ΄κ³  33306ν¬νΈκ°€ μ•„λ‹ 3306μΌλ΅ λ‚μ¤λ” μ΄μ λ„ λ„μ»¤μ μ™Έλ¶€ν¬νΈ λ‚΄λ¶€ν¬νΈλ¥Ό λ³€κ²½ν•΄μ„μ…λ‹λ‹¤. 

ν„μ¬ μ € λΉ¨κ°„μƒ‰ ν¨ν‚· λ¶€λ¶„μ€ κ²°κµ­ 39.115.214.146μ΄λΌλ” μ  λ…ΈνΈλ¶μ΄ μ €μ μ§‘μ— μλ” μ„λ²„μΈ 180.224.180.78μ 33306ν¬νΈλ΅ μ ‘κ·Όν–λ‹¤ λΌκ³  μƒκ°ν•΄μ£Όμ‹λ©΄ λ  κ²ƒ κ°™μ•„μ”.

**κ²°κµ­ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ„λ²„λ΅ μ ‘μ†λλ” ν¨ν‚·μ΄ μ •μƒμ μΌλ΅ SYN, SYN/ACK, ACKκ°€ λ κ²ƒμ„ ν™•μΈν•  μ μκ³  ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„μ—μ„ λ¨λ‘ ν¨ν‚·μ„ ν™•μΈν•  μ μμ—μµλ‹λ‹¤.**

#### ν΄λΌμ΄μ–ΈνΈμ—μ„ μ •μƒμ μΌλ΅ μ„λ²„μ— μ ‘μ†λμ§€ μ•λ” κ²½μ°

**1. μ„λ²„κ°€ Down λμ–΄μμ„ λ•**

![Alt text](img4.png)

**ν΄λΌμ΄μ–ΈνΈμ—μ„ ν™•μΈν• tcpdump**
![Alt text](img5.png)

**SEWλ” SYN ECE CWRμ μ•½μμ…λ‹λ‹¤.**
- SYNμ€ μƒλ΅μ΄ μ—°κ²°μ„ μ‹μ‘ν•λ‹¤λ” μ΄μ•ΌκΈ°μ΄κ³ 
- ECEλ” Explicit Congestion Notificationμ΄λΌλ” TCPνΌμ΅μ μ–΄ κΈ°λ¥μ„ μ‚¬μ©ν•  μ μλ‹¤κ³  μ•λ ¤μ£Όλ” κ²ƒμ…λ‹λ‹¤.
- CWR(Congestion Window Reduced)μ€ μ¬λΌμ΄λ”©μλ„μ°μ μλ„μ° μ‚¬μ΄μ¦λ¥Ό μ¤„μ—¬λ‹¬λΌλ” λ»μ…λ‹λ‹¤.
  
κ²°κµ­ SEWλ„ **SYNμ μΌμΆ…μΌλ΅ SYN**μ„ λ³΄λƒμΌλ‚ Flagκ°€ <b>[S.]</b>κ°€ μ•„λ‹ <b>[R.]</b> **μ—°κ²°μΆ…λ£κ°€** λ‚μ™”μΌλ―€λ΅ μ„λ²„μ™€ μ •μƒμ μΌλ΅ μ—°κ²°λ  μ μ—†λ” κ²ƒμ„ μ• μ μμµλ‹λ‹¤. **μ΄λ• ν΄λΌμ΄μ–ΈνΈμ—μ„λ” SYNμ„ λ³΄λ‚Έ κ² ν™•μΈλμ—κΈ° λ•λ¬Έμ— SYNμ„ λ³΄λ‚Έ ν΄λΌμ΄μ–ΈνΈμ—μ„λ” μ „ν€ μ ‘μ†ν•λ” λ° λ¬Έμ κ°€ μ—†λ” κ²ƒμ΄κ³  μ„λ²„ μ½μ΄ λ¬Έμ  μμ„ μ μλ‹¤λΌκ³  μ μ¶”ν•  μ μκ² λ©λ‹λ‹¤.** 

**2. μ„λ²„ μƒλ‹¨μ λ°©ν™”λ²½μ΄ λ§‰κ³  μμ„ λ•**

μ‹¤μ λ΅ μ¤‘μ”ν• νμ‚¬ μ„λ²„λ“¤μ€ μ„λ²„ μ•λ‹¨μ— λ°©ν™”λ²½ κ°™μ€ λ³΄μ• μ¥λΉ„λ¥Ό λ‘λ” κ²½μ°κ°€ λ§μµλ‹λ‹¤. μ†ν”„νΈμ›¨μ–΄ λ‹¨κ³„μ—μ„μ λ°©ν™”λ²½λ„ μμΌλ©° ν•λ“μ›¨μ–΄λ“  μ†ν”„νΈμ›¨μ–΄λ΅ μ΄λ£¨μ–΄μ Έ μλ“  MySQLμ„λ²„ μ•λ‹¨μ—μ„ 33306μΌλ΅ λ“¤μ–΄μ¤λ” **ν¬νΈλ¥Ό μ°¨λ‹¨ν•  κ²½μ° μ™Έλ¶€μ—μ„λ” λ‚΄λ¶€μ— μλ” MySQLμ„λ²„λ¥Ό μ ‘μ†ν•μ§€ λ»ν•λ” κ±°μ£ **. μ κ°€ νμ‚¬μ— λ‹¤λ‹λ©° κ²μ—λ κ°€μ¥ ν”ν• μΌ μ¤‘μ ν•λ‚μ€μµλ‹λ‹¤.

![Alt text](img6.png)

κ·ΈλΌ 192.168.1.84μΈ ν΄λΌμ΄μ–ΈνΈμ—μ„ 180.224.180.78 μ„λ²„λ΅ μ ‘μ† μ”μ²­μ„ μ‹λ„ν•΄λ³΄κ² μµλ‹λ‹¤.

**ν΄λΌμ΄μ–ΈνΈμ—μ„ ν™•μΈν• tcpdump**
![Alt text](image-11.png)

180.224.180.78λ΅ κ³„μ† SYN ν¨ν‚·μ„ λ‚ λ¦¬κ³  μμµλ‹λ‹¤. μ„μ—μ„ μ„λ²„κ°€ λ‹¤μ΄λμ—μ„ λ•λ” μ°Ύμ§€ λ»ν•΄ [R.] Flagκ°€ λ¨λ©° λ°”λ΅ μΆ…λ£λμ—μΌλ‚ ν„μ¬ μ„λ²„λ” λ‹¤μ΄λμ§€ μ•μ•μ§€λ§, **λ°©ν™”λ²½μ— μν•΄ ν¬νΈκ°€ μ°¨λ‹¨μ΄ λμ–΄ SYN ν¨ν‚·μ€ λ‚ μ•„κ°€μ§€λ§ μ„λ²„μ—μ„λ” μ‘λ‹µμ€ μ—†λ” ν„μƒμ΄ λ°μƒ**ν•λ” κ²ƒμ…λ‹λ‹¤. κ·ΈλΌ MySQLμ„λ²„λ” λ‹¤μ΄λμ§€ μ•μ•μΌλ‹ ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μ ‘μ† μ”μ²­μ„ λ³΄λ‚Ό λ• μ„λ²„μ—μ„ ν¨ν‚·μ„ ν• λ² μΊ΅μ²ν•΄λ³ΌκΉμ”?

**μ„λ²„μ—μ„ ν™•μΈν• tcpdump**
![Alt text](image-12.png)

μμƒν•μ…¨κ² μ§€λ§ **μ•„λ¬΄λ° ν¨ν‚·μ„ λ°›μ„ μ μ—†μ—μµλ‹λ‹¤**. μ„λ²„ μƒλ‹¨μ— μλ” λ°©ν™”λ²½μ—μ„ ν¨ν‚·μ„ λ§‰κ³  μκΈ° λ•λ¬Έμ— λ°©ν™”λ²½μ„ ν†µκ³Όν•  μ μ—†μ–΄ μ΄λ° ν„μƒμ΄ λ°μƒν•κ³ , μ΄μ²λΌ ν΄λΌμ΄μ–ΈνΈμ—μ„ λ‚κ°€λ” κ²ƒμ€ ν™•μΈν–λ”λ° μ„λ²„κΉμ§€ μ• λ“¤μ–΄μ¨λ‹¤κ³  ν•λ©΄ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ¶λ° μ΄ν›„ μ„λ²„μ—κ² λ„μ°©ν•κΈ°μ „κΉμ§€ μ–΄λ–¤ μ¥λΉ„λ‚ μ†ν”„νΈμ›¨μ–΄μ— μν•΄ λ§‰ν€μλ‹¤κ³  νλ‹¨ν•  μ μλ” κ±°μ£ . 

λ°©ν™”λ²½ μ°¨λ‹¨λΏλ§ μ•„λ‹λΌ ν¬νΈν¬μ›λ”©μ„ μλ» μ„¤μ •ν–μ„ λ•, AWSμ—μ„ λ³΄μ• κ·Έλ£Ή μ„¤μ •μ„ μλ»ν–μ„ λ• λ“± λ‹¤μ–‘ν• μ›μΈμ— μν•΄ λ°μƒν•  μ μμµλ‹λ‹¤. 


### λ§μ§€λ§‰μΌλ΅

ν΄λΌμ΄μ–ΈνΈμ—μ„ μ„λ²„λ΅ μ ‘μ†μ΄ μ• λλ” κ²½μ°λ” μ‚¬μ‹¤ μ–΄λ””κ°€ μλ»λμ—λ‹¤κ³  μ‰½κ² νΉμ •ν•  μλ” μ—†μµλ‹λ‹¤. μ •λ§ λ‹¤μ–‘ν• μ›μΈμ— μν•΄ λ°μƒν•  μ μλ” λ¬Έμ μ΄μ§€λ§ μ•μ—μ„ λ§μ”€λ“λ¦° κ²ƒμ²λΌ tcpdumpλ¥Ό μ΄μ©ν•λ‹¤λ©΄ λ„¤νΈμ›ν¬ μ–΄λ κµ¬κ°„μ—μ„ λ¬Έμ κ°€ μλ”μ§€ μ μ¶”ν•  μ μμ–΄ μ‹κ°„μ„ μ μ•½ν•  μ μμµλ‹λ‹¤.

λ¨λ“  λ¶„μ΄ μ΄ν•΄ν•κΈ° μ‰½κ² μ‘μ„±ν•κΈ° μ„ν•΄ μμ„Έν•κ² μ κΈ°λ³΄λ‹¤λ” μ–΄λ– ν• μ›λ¦¬λ΅ νΈλ¬λΈ” μν…ν•  μ μλ”μ§€μ— μ΄μ μ„ λ§μ¶°μ„ κΈ€μ„ μ‘μ„±ν–μµλ‹λ‹¤. tcpdumpλ” μ‹¤μ λ΅ ν™μ©ν•  μ μλ” λ°©λ²•μ΄ λ§μΌλ―€λ΅ ν• λ² λ”°λ΅ κ³µλ¶€ν•΄λ³΄μ‹λ” κ²ƒλ„ μ¶”μ²ν•΄ λ“λ¦½λ‹λ‹¤!


### λ²μ™Έ
![Alt text](image-13.png)

SpringBootμ—μ„ JDBCλ¥Ό μ‚¬μ©ν•λ©΄ Hikari CP(μ»¤λ„¥μ… ν’€)λ¥Ό μ΄μ©ν•κ² λλ”λ° μ΄λ• κ°’μ„ μ„¤μ •ν•μ§€ μ•μΌλ©΄ λ””ν΄νΈ κ°’μΌλ΅ μ›Ήμ„λ²„μ™€ DBμ„λ²„ μ‚¬μ΄μ— ν’€μ„ 10κ° λ§λ“¤κ² λ©λ‹λ‹¤. μ΄κ²ƒλ„ μ‚¬μ‹¤ λ°μ΄ν„°λ² μ΄μ¤μ™€ μ›Ήμ„λ²„κ°€ λ„¤νΈμ›ν¬ ν†µμ‹ μΌλ΅ μ΄λ£¨μ–΄μ§€κΈ° λ•λ¬Έμ— μ„μ™€ κ°™μ΄ ν¨ν‚·μ„ μΊ΅μ²ν•΄μ„ μ‹¤μ λ΅ **10λ²μ μ”μ²­μ„** λ³΄λ‚΄λ”μ§€ μ• μ μκ² λ©λ‹λ‹¤. μ„ μ‚¬μ§„μ—μ„λ„ SEW μ¦‰, SYN ν¨ν‚·μ΄ 10λ² λ‚ μ•„κ°„ κ²ƒμ„ ν™•μΈν•΄λ³Ό μ μμµλ‹λ‹¤!


κΈ΄ κΈ€ μ½μ–΄μ£Όμ…”μ„ κ°μ‚¬ν•©λ‹λ‹¤. π™π™π™





